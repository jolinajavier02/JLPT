<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Challenge Mode - NihongoMastery</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Noto+Sans+JP:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            background: #f8fafc;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .test-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
            max-width: 1000px;
            margin: 0 auto;
            width: 100%;
        }

        .challenge-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .module-nav {
            display: flex;
            gap: 1rem;
            margin-bottom: 3rem;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
        }

        .nav-btn {
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: var(--text-color);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-color);
        }

        .nav-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 4px 15px rgba(188, 0, 45, 0.3);
        }

        /* Flashcard Styles */
        .challenge-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            gap: 2rem;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }

        .challenge-area.active {
            opacity: 1;
            transform: translateY(0);
        }

        .flashcard-container {
            perspective: 1000px;
            width: 100%;
            max-width: 500px;
            height: 350px;
            cursor: pointer;
        }

        .flashcard {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: var(--shadow-lg);
            border-radius: 24px;
        }

        .flashcard.flipped {
            transform: rotateY(180deg);
        }

        .flashcard-front,
        .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 24px;
            padding: 2.5rem;
            background: white;
        }

        .flashcard-back {
            transform: rotateY(180deg);
            background: var(--primary-color);
            color: white;
        }

        .card-char {
            font-size: 6rem;
            font-family: var(--font-jp);
            font-weight: 700;
            margin-bottom: 1rem;
            line-height: 1.2;
        }

        .card-info {
            font-size: 1.1rem;
            color: var(--text-light);
            max-width: 90%;
        }

        .flashcard-back .card-info {
            color: rgba(255, 255, 255, 0.9);
        }

        .card-answer {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .card-meaning {
            font-size: 1.5rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 400;
        }

        .controls {
            display: flex;
            gap: 1rem;
        }

        .module-badge {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: rgba(0, 0, 0, 0.05);
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-light);
        }

        .flashcard-back .module-badge {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        /* Grammar/Sentence specific */
        .scrambled-box {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--secondary-color);
            background: #f1f5f9;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            border: 2px dashed #cbd5e1;
        }

        /* Header Button Fade */
        .header-btn {
            opacity: 0.5;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <header class="main-header">
        <div class="container">
            <nav>
                <a href="home.html" class="logo">NihongoMastery</a>
                <div class="nav-links">
                    <a href="home.html" class="nav-link">Dashboard</a>
                    <a href="test.html" class="header-btn">Take Test</a>
                </div>
            </nav>
        </div>
    </header>

    <div class="test-container fixed-header-offset">
        <div class="challenge-header">
            <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem;">Challenge Mode</h1>
            <p style="color: var(--text-light);">Select a module to start your interactive practice session.</p>
        </div>

        <div class="module-nav">
            <button class="nav-btn" onclick="switchModule('all', this)">All Challenge</button>
            <button class="nav-btn" onclick="switchModule('hiragana', this)">Hiragana</button>
            <button class="nav-btn" onclick="switchModule('katakana', this)">Katakana</button>
            <button class="nav-btn" onclick="switchModule('kanji', this)">Kanji</button>
            <button class="nav-btn" onclick="switchModule('grammar', this)">Grammar</button>
            <button class="nav-btn" onclick="switchModule('particles', this)">Particle</button>
            <button class="nav-btn" onclick="switchModule('vocabulary', this)">Vocabulary</button>
        </div>

        <!-- Integrated Challenge Area -->
        <div id="challenge-area" class="challenge-area">
            <div style="text-align: center; margin-bottom: 0.5rem;">
                <h1 id="current-module-title" style="margin-bottom: 0.2rem;">Select a Module</h1>
                <p style="color: var(--text-light); font-size: 0.9rem;">Click the card to reveal the answer</p>
            </div>

            <div class="flashcard-container" onclick="flipCard()">
                <div id="flashcard" class="flashcard">
                    <div class="flashcard-front">
                        <div id="card-module" class="module-badge">Module</div>
                        <div id="card-front-main" class="card-char">?</div>
                        <div id="card-front-sub" class="card-info">Select a module above to begin</div>
                    </div>
                    <div class="flashcard-back">
                        <div id="card-back-main" class="card-answer">Answer</div>
                        <div id="card-back-sub" class="card-meaning">Meaning</div>
                    </div>
                </div>
            </div>

            <div class="controls">
                <button class="btn btn-primary" style="padding: 1rem 3rem; border-radius: 50px;"
                    onclick="nextCard()">Next Challenge</button>
            </div>
        </div>
    </div>

    <script>
        const hiraganaData = [
            // Basic
            { char: 'あ', romaji: 'a', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'い', romaji: 'i', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'う', romaji: 'u', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'え', romaji: 'e', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'お', romaji: 'o', meaning: 'Hiragana', type: 'Hiragana' },
            { char: 'か', romaji: 'ka', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'き', romaji: 'ki', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'く', romaji: 'ku', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'け', romaji: 'ke', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'こ', romaji: 'ko', meaning: 'Hiragana', type: 'Hiragana' },
            { char: 'さ', romaji: 'sa', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'し', romaji: 'shi', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'す', romaji: 'su', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'せ', romaji: 'se', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'そ', romaji: 'so', meaning: 'Hiragana', type: 'Hiragana' },
            { char: 'た', romaji: 'ta', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'ち', romaji: 'chi', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'つ', romaji: 'tsu', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'て', romaji: 'te', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'と', romaji: 'to', meaning: 'Hiragana', type: 'Hiragana' },
            { char: 'な', romaji: 'na', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'に', romaji: 'ni', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'ぬ', romaji: 'nu', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'ね', romaji: 'ne', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'の', romaji: 'no', meaning: 'Hiragana', type: 'Hiragana' },
            { char: 'は', romaji: 'ha', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'ひ', romaji: 'hi', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'ふ', romaji: 'fu', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'へ', romaji: 'he', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'ほ', romaji: 'ho', meaning: 'Hiragana', type: 'Hiragana' },
            { char: 'ま', romaji: 'ma', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'み', romaji: 'mi', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'む', romaji: 'mu', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'め', romaji: 'me', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'も', romaji: 'mo', meaning: 'Hiragana', type: 'Hiragana' },
            { char: 'や', romaji: 'ya', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'ゆ', romaji: 'yu', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'よ', romaji: 'yo', meaning: 'Hiragana', type: 'Hiragana' },
            { char: 'ら', romaji: 'ra', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'り', romaji: 'ri', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'る', romaji: 'ru', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'れ', romaji: 're', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'ろ', romaji: 'ro', meaning: 'Hiragana', type: 'Hiragana' },
            { char: 'わ', romaji: 'wa', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'を', romaji: 'wo', meaning: 'Hiragana', type: 'Hiragana' }, { char: 'ん', romaji: 'n', meaning: 'Hiragana', type: 'Hiragana' },
            // Dakuten (Voiced)
            { char: 'が', romaji: 'ga', meaning: 'Hiragana (Dakuten)', type: 'Hiragana' }, { char: 'ぎ', romaji: 'gi', meaning: 'Hiragana (Dakuten)', type: 'Hiragana' }, { char: 'ぐ', romaji: 'gu', meaning: 'Hiragana (Dakuten)', type: 'Hiragana' }, { char: 'げ', romaji: 'ge', meaning: 'Hiragana (Dakuten)', type: 'Hiragana' }, { char: 'ご', romaji: 'go', meaning: 'Hiragana (Dakuten)', type: 'Hiragana' },
            { char: 'ざ', romaji: 'za', meaning: 'Hiragana (Dakuten)', type: 'Hiragana' }, { char: 'じ', romaji: 'ji', meaning: 'Hiragana (Dakuten)', type: 'Hiragana' }, { char: 'ず', romaji: 'zu', meaning: 'Hiragana (Dakuten)', type: 'Hiragana' }, { char: 'ぜ', romaji: 'ze', meaning: 'Hiragana (Dakuten)', type: 'Hiragana' }, { char: 'ぞ', romaji: 'zo', meaning: 'Hiragana (Dakuten)', type: 'Hiragana' },
            { char: 'だ', romaji: 'da', meaning: 'Hiragana (Dakuten)', type: 'Hiragana' }, { char: 'ぢ', romaji: 'ji', meaning: 'Hiragana (Dakuten)', type: 'Hiragana' }, { char: 'づ', romaji: 'zu', meaning: 'Hiragana (Dakuten)', type: 'Hiragana' }, { char: 'で', romaji: 'de', meaning: 'Hiragana (Dakuten)', type: 'Hiragana' }, { char: 'ど', romaji: 'do', meaning: 'Hiragana (Dakuten)', type: 'Hiragana' },
            { char: 'ば', romaji: 'ba', meaning: 'Hiragana (Dakuten)', type: 'Hiragana' }, { char: 'び', romaji: 'bi', meaning: 'Hiragana (Dakuten)', type: 'Hiragana' }, { char: 'ぶ', romaji: 'bu', meaning: 'Hiragana (Dakuten)', type: 'Hiragana' }, { char: 'べ', romaji: 'be', meaning: 'Hiragana (Dakuten)', type: 'Hiragana' }, { char: 'ぼ', romaji: 'bo', meaning: 'Hiragana (Dakuten)', type: 'Hiragana' },
            { char: 'ぱ', romaji: 'pa', meaning: 'Hiragana (Handakuten)', type: 'Hiragana' }, { char: 'ぴ', romaji: 'pi', meaning: 'Hiragana (Handakuten)', type: 'Hiragana' }, { char: 'ぷ', romaji: 'pu', meaning: 'Hiragana (Handakuten)', type: 'Hiragana' }, { char: 'ぺ', romaji: 'pe', meaning: 'Hiragana (Handakuten)', type: 'Hiragana' }, { char: 'ぽ', romaji: 'po', meaning: 'Hiragana (Handakuten)', type: 'Hiragana' },
            // Yoon (Combination)
            { char: 'きゃ', romaji: 'kya', meaning: 'Hiragana (Yoon)', type: 'Hiragana' }, { char: 'きゅ', romaji: 'kyu', meaning: 'Hiragana (Yoon)', type: 'Hiragana' }, { char: 'きょ', romaji: 'kyo', meaning: 'Hiragana (Yoon)', type: 'Hiragana' },
            { char: 'しゃ', romaji: 'sha', meaning: 'Hiragana (Yoon)', type: 'Hiragana' }, { char: 'しゅ', romaji: 'shu', meaning: 'Hiragana (Yoon)', type: 'Hiragana' }, { char: 'しょ', romaji: 'sho', meaning: 'Hiragana (Yoon)', type: 'Hiragana' },
            { char: 'ちゃ', romaji: 'cha', meaning: 'Hiragana (Yoon)', type: 'Hiragana' }, { char: 'ちゅ', romaji: 'chu', meaning: 'Hiragana (Yoon)', type: 'Hiragana' }, { char: 'ちょ', romaji: 'cho', meaning: 'Hiragana (Yoon)', type: 'Hiragana' },
            { char: 'にゃ', romaji: 'nya', meaning: 'Hiragana (Yoon)', type: 'Hiragana' }, { char: 'にゅ', romaji: 'nyu', meaning: 'Hiragana (Yoon)', type: 'Hiragana' }, { char: 'にょ', romaji: 'nyo', meaning: 'Hiragana (Yoon)', type: 'Hiragana' },
            { char: 'ひゃ', romaji: 'hya', meaning: 'Hiragana (Yoon)', type: 'Hiragana' }, { char: 'ひゅ', romaji: 'hyu', meaning: 'Hiragana (Yoon)', type: 'Hiragana' }, { char: 'ひょ', romaji: 'hyo', meaning: 'Hiragana (Yoon)', type: 'Hiragana' },
            { char: 'みゃ', romaji: 'mya', meaning: 'Hiragana (Yoon)', type: 'Hiragana' }, { char: 'みゅ', romaji: 'myu', meaning: 'Hiragana (Yoon)', type: 'Hiragana' }, { char: 'みょ', romaji: 'myo', meaning: 'Hiragana (Yoon)', type: 'Hiragana' },
            { char: 'りゃ', romaji: 'rya', meaning: 'Hiragana (Yoon)', type: 'Hiragana' }, { char: 'りゅ', romaji: 'ryu', meaning: 'Hiragana (Yoon)', type: 'Hiragana' }, { char: 'りょ', romaji: 'ryo', meaning: 'Hiragana (Yoon)', type: 'Hiragana' },
            { char: 'ぎゃ', romaji: 'gya', meaning: 'Hiragana (Yoon)', type: 'Hiragana' }, { char: 'ぎゅ', romaji: 'gyu', meaning: 'Hiragana (Yoon)', type: 'Hiragana' }, { char: 'ぎょ', romaji: 'gyo', meaning: 'Hiragana (Yoon)', type: 'Hiragana' },
            { char: 'じゃ', romaji: 'ja', meaning: 'Hiragana (Yoon)', type: 'Hiragana' }, { char: 'じゅ', romaji: 'ju', meaning: 'Hiragana (Yoon)', type: 'Hiragana' }, { char: 'じょ', romaji: 'jo', meaning: 'Hiragana (Yoon)', type: 'Hiragana' },
            { char: 'びゃ', romaji: 'bya', meaning: 'Hiragana (Yoon)', type: 'Hiragana' }, { char: 'びゅ', romaji: 'byu', meaning: 'Hiragana (Yoon)', type: 'Hiragana' }, { char: 'びょ', romaji: 'byo', meaning: 'Hiragana (Yoon)', type: 'Hiragana' },
            { char: 'ぴゃ', romaji: 'pya', meaning: 'Hiragana (Yoon)', type: 'Hiragana' }, { char: 'ぴゅ', romaji: 'pyu', meaning: 'Hiragana (Yoon)', type: 'Hiragana' }, { char: 'ぴょ', romaji: 'pyo', meaning: 'Hiragana (Yoon)', type: 'Hiragana' }
        ];

        const katakanaData = [
            // Basic
            { char: 'ア', romaji: 'a', meaning: 'Katakana', type: 'Katakana' }, { char: 'イ', romaji: 'i', meaning: 'Katakana', type: 'Katakana' }, { char: 'ウ', romaji: 'u', meaning: 'Katakana', type: 'Katakana' }, { char: 'エ', romaji: 'e', meaning: 'Katakana', type: 'Katakana' }, { char: 'オ', romaji: 'o', meaning: 'Katakana', type: 'Katakana' },
            { char: 'カ', romaji: 'ka', meaning: 'Katakana', type: 'Katakana' }, { char: 'キ', romaji: 'ki', meaning: 'Katakana', type: 'Katakana' }, { char: 'ク', romaji: 'ku', meaning: 'Katakana', type: 'Katakana' }, { char: 'ケ', romaji: 'ke', meaning: 'Katakana', type: 'Katakana' }, { char: 'コ', romaji: 'ko', meaning: 'Katakana', type: 'Katakana' },
            { char: 'サ', romaji: 'sa', meaning: 'Katakana', type: 'Katakana' }, { char: 'シ', romaji: 'shi', meaning: 'Katakana', type: 'Katakana' }, { char: 'ス', romaji: 'su', meaning: 'Katakana', type: 'Katakana' }, { char: 'セ', romaji: 'se', meaning: 'Katakana', type: 'Katakana' }, { char: 'ソ', romaji: 'so', meaning: 'Katakana', type: 'Katakana' },
            { char: 'タ', romaji: 'ta', meaning: 'Katakana', type: 'Katakana' }, { char: 'チ', romaji: 'chi', meaning: 'Katakana', type: 'Katakana' }, { char: 'ツ', romaji: 'tsu', meaning: 'Katakana', type: 'Katakana' }, { char: 'テ', romaji: 'te', meaning: 'Katakana', type: 'Katakana' }, { char: 'ト', romaji: 'to', meaning: 'Katakana', type: 'Katakana' },
            { char: 'ナ', romaji: 'na', meaning: 'Katakana', type: 'Katakana' }, { char: 'ニ', romaji: 'ni', meaning: 'Katakana', type: 'Katakana' }, { char: 'ヌ', romaji: 'nu', meaning: 'Katakana', type: 'Katakana' }, { char: 'ネ', romaji: 'ne', meaning: 'Katakana', type: 'Katakana' }, { char: 'ノ', romaji: 'no', meaning: 'Katakana', type: 'Katakana' },
            { char: 'ハ', romaji: 'ha', meaning: 'Katakana', type: 'Katakana' }, { char: 'ヒ', romaji: 'hi', meaning: 'Katakana', type: 'Katakana' }, { char: 'フ', romaji: 'fu', meaning: 'Katakana', type: 'Katakana' }, { char: 'ヘ', romaji: 'he', meaning: 'Katakana', type: 'Katakana' }, { char: 'ホ', romaji: 'ho', meaning: 'Katakana', type: 'Katakana' },
            { char: 'マ', romaji: 'ma', meaning: 'Katakana', type: 'Katakana' }, { char: 'ミ', romaji: 'mi', meaning: 'Katakana', type: 'Katakana' }, { char: 'ム', romaji: 'mu', meaning: 'Katakana', type: 'Katakana' }, { char: 'メ', romaji: 'me', meaning: 'Katakana', type: 'Katakana' }, { char: 'モ', romaji: 'mo', meaning: 'Katakana', type: 'Katakana' },
            { char: 'ヤ', romaji: 'ya', meaning: 'Katakana', type: 'Katakana' }, { char: 'ユ', romaji: 'yu', meaning: 'Katakana', type: 'Katakana' }, { char: 'ヨ', romaji: 'yo', meaning: 'Katakana', type: 'Katakana' },
            { char: 'ラ', romaji: 'ra', meaning: 'Katakana', type: 'Katakana' }, { char: 'リ', romaji: 'ri', meaning: 'Katakana', type: 'Katakana' }, { char: 'ル', romaji: 'ru', meaning: 'Katakana', type: 'Katakana' }, { char: 'レ', romaji: 're', meaning: 'Katakana', type: 'Katakana' }, { char: 'ロ', romaji: 'ro', meaning: 'Katakana', type: 'Katakana' },
            { char: 'ワ', romaji: 'wa', meaning: 'Katakana', type: 'Katakana' }, { char: 'ヲ', romaji: 'wo', meaning: 'Katakana', type: 'Katakana' }, { char: 'ン', romaji: 'n', meaning: 'Katakana', type: 'Katakana' },
            // Dakuten (Voiced)
            { char: 'ガ', romaji: 'ga', meaning: 'Katakana (Dakuten)', type: 'Katakana' }, { char: 'ギ', romaji: 'gi', meaning: 'Katakana (Dakuten)', type: 'Katakana' }, { char: 'グ', romaji: 'gu', meaning: 'Katakana (Dakuten)', type: 'Katakana' }, { char: 'ゲ', romaji: 'ge', meaning: 'Katakana (Dakuten)', type: 'Katakana' }, { char: 'ゴ', romaji: 'go', meaning: 'Katakana (Dakuten)', type: 'Katakana' },
            { char: 'ザ', romaji: 'za', meaning: 'Katakana (Dakuten)', type: 'Katakana' }, { char: 'ジ', romaji: 'ji', meaning: 'Katakana (Dakuten)', type: 'Katakana' }, { char: 'ズ', romaji: 'zu', meaning: 'Katakana (Dakuten)', type: 'Katakana' }, { char: 'ゼ', romaji: 'ze', meaning: 'Katakana (Dakuten)', type: 'Katakana' }, { char: 'ゾ', romaji: 'zo', meaning: 'Katakana (Dakuten)', type: 'Katakana' },
            { char: 'ダ', romaji: 'da', meaning: 'Katakana (Dakuten)', type: 'Katakana' }, { char: 'ヂ', romaji: 'ji', meaning: 'Katakana (Dakuten)', type: 'Katakana' }, { char: 'ヅ', romaji: 'zu', meaning: 'Katakana (Dakuten)', type: 'Katakana' }, { char: 'デ', romaji: 'de', meaning: 'Katakana (Dakuten)', type: 'Katakana' }, { char: 'ド', romaji: 'do', meaning: 'Katakana (Dakuten)', type: 'Katakana' },
            { char: 'バ', romaji: 'ba', meaning: 'Katakana (Dakuten)', type: 'Katakana' }, { char: 'ビ', romaji: 'bi', meaning: 'Katakana (Dakuten)', type: 'Katakana' }, { char: 'ブ', romaji: 'bu', meaning: 'Katakana (Dakuten)', type: 'Katakana' }, { char: 'ベ', romaji: 'be', meaning: 'Katakana (Dakuten)', type: 'Katakana' }, { char: 'ボ', romaji: 'bo', meaning: 'Katakana (Dakuten)', type: 'Katakana' },
            { char: 'パ', romaji: 'pa', meaning: 'Katakana (Handakuten)', type: 'Katakana' }, { char: 'ピ', romaji: 'pi', meaning: 'Katakana (Handakuten)', type: 'Katakana' }, { char: 'プ', romaji: 'pu', meaning: 'Katakana (Handakuten)', type: 'Katakana' }, { char: 'ペ', romaji: 'pe', meaning: 'Katakana (Handakuten)', type: 'Katakana' }, { char: 'ポ', romaji: 'po', meaning: 'Katakana (Handakuten)', type: 'Katakana' },
            // Yoon (Combination)
            { char: 'キャ', romaji: 'kya', meaning: 'Katakana (Yoon)', type: 'Katakana' }, { char: 'キュ', romaji: 'kyu', meaning: 'Katakana (Yoon)', type: 'Katakana' }, { char: 'キョ', romaji: 'kyo', meaning: 'Katakana (Yoon)', type: 'Katakana' },
            { char: 'シャ', romaji: 'sha', meaning: 'Katakana (Yoon)', type: 'Katakana' }, { char: 'シュ', romaji: 'shu', meaning: 'Katakana (Yoon)', type: 'Katakana' }, { char: 'ショ', romaji: 'sho', meaning: 'Katakana (Yoon)', type: 'Katakana' },
            { char: 'チャ', romaji: 'cha', meaning: 'Katakana (Yoon)', type: 'Katakana' }, { char: 'チュ', romaji: 'chu', meaning: 'Katakana (Yoon)', type: 'Katakana' }, { char: 'チョ', romaji: 'cho', meaning: 'Katakana (Yoon)', type: 'Katakana' },
            { char: 'ニャ', romaji: 'nya', meaning: 'Katakana (Yoon)', type: 'Katakana' }, { char: 'ニュ', romaji: 'nyu', meaning: 'Katakana (Yoon)', type: 'Katakana' }, { char: 'ニョ', romaji: 'nyo', meaning: 'Katakana (Yoon)', type: 'Katakana' },
            { char: 'ヒャ', romaji: 'hya', meaning: 'Katakana (Yoon)', type: 'Katakana' }, { char: 'ヒュ', romaji: 'hyu', meaning: 'Katakana (Yoon)', type: 'Katakana' }, { char: 'ヒョ', romaji: 'hyo', meaning: 'Katakana (Yoon)', type: 'Katakana' },
            { char: 'ミャ', romaji: 'mya', meaning: 'Katakana (Yoon)', type: 'Katakana' }, { char: 'ミュ', romaji: 'myu', meaning: 'Katakana (Yoon)', type: 'Katakana' }, { char: 'ミョ', romaji: 'myo', meaning: 'Katakana (Yoon)', type: 'Katakana' },
            { char: 'リャ', romaji: 'rya', meaning: 'Katakana (Yoon)', type: 'Katakana' }, { char: 'リュ', romaji: 'ryu', meaning: 'Katakana (Yoon)', type: 'Katakana' }, { char: 'リョ', romaji: 'ryo', meaning: 'Katakana (Yoon)', type: 'Katakana' },
            { char: 'ギャ', romaji: 'gya', meaning: 'Katakana (Yoon)', type: 'Katakana' }, { char: 'ギュ', romaji: 'gyu', meaning: 'Katakana (Yoon)', type: 'Katakana' }, { char: 'ギョ', romaji: 'gyo', meaning: 'Katakana (Yoon)', type: 'Katakana' },
            { char: 'ジャ', romaji: 'ja', meaning: 'Katakana (Yoon)', type: 'Katakana' }, { char: 'ジュ', romaji: 'ju', meaning: 'Katakana (Yoon)', type: 'Katakana' }, { char: 'ジョ', romaji: 'jo', meaning: 'Katakana (Yoon)', type: 'Katakana' },
            { char: 'ビャ', romaji: 'bya', meaning: 'Katakana (Yoon)', type: 'Katakana' }, { char: 'ビュ', romaji: 'byu', meaning: 'Katakana (Yoon)', type: 'Katakana' }, { char: 'ビョ', romaji: 'byo', meaning: 'Katakana (Yoon)', type: 'Katakana' },
            { char: 'ピャ', romaji: 'pya', meaning: 'Katakana (Yoon)', type: 'Katakana' }, { char: 'ピュ', romaji: 'pyu', meaning: 'Katakana (Yoon)', type: 'Katakana' }, { char: 'ピョ', romaji: 'pyo', meaning: 'Katakana (Yoon)', type: 'Katakana' }
        ];

        // Kanji Data - Lazy Loading Strategy
        let kanjiData = {}; // Cache for loaded Kanji details
        let allKanjiList = []; // Full list of characters from API

        const grammarData = [
            { char: '私は寿司を食べます', kana: 'わたしはすしをたべます', romaji: 'Watashi wa sushi o tabemasu', meaning: 'I eat sushi', type: 'Grammar' },
            { char: '田中さんは本を読みます', kana: 'たなかさんはほんをよみます', romaji: 'Tanaka-san wa hon o yomimasu', meaning: 'Mr. Tanaka reads a book', type: 'Grammar' },
            { char: '私は水を飲みます', kana: 'わたしはみずをのみます', romaji: 'Watashi wa mizu o nomimasu', meaning: 'I drink water', type: 'Grammar' },
            { char: '先生は日本語を話します', kana: 'せんせいはにほんごをはなします', romaji: 'Sensei wa nihongo o hanashimasu', meaning: 'The teacher speaks Japanese', type: 'Grammar' },
            { char: '私は映画を見ます', kana: 'わたしはえいがをみます', romaji: 'Watashi wa eiga o mimasu', meaning: 'I watch a movie', type: 'Grammar' },
            { char: '昨日、寿司を食べました', kana: 'きのう、すしをたべました', romaji: 'Kinou, sushi o tabemashita', meaning: 'I ate sushi yesterday', type: 'Grammar' },
            { char: '明日、学校に行きます', kana: 'あした、がっこうにいきます', romaji: 'Ashita, gakkou ni ikimasu', meaning: 'I will go to school tomorrow', type: 'Grammar' },
            { char: '今、コーヒーを飲みます', kana: 'いま、こーひーをのみます', romaji: 'Ima, ko-hi- o nomimasu', meaning: 'I drink coffee now', type: 'Grammar' },
            { char: '毎日勉強をします', kana: 'まいにちべんきょうをします', romaji: 'Mainichi benkyou o shimasu', meaning: 'I study every day', type: 'Grammar' },
            { char: '友達が家に来ます', kana: 'ともだちがうちにきます', romaji: 'Tomodachi ga uchi ni kimasu', meaning: 'A friend is coming to my house', type: 'Grammar' },
            { char: 'この寿司はとても美味しいです', kana: 'このすしはとてもおいしいです', romaji: 'Kono sushi wa totemo oishii desu', meaning: 'This sushi is very delicious', type: 'Grammar' },
            { char: '綺麗な花ですね', kana: 'きれいなはなですね', romaji: 'Kirei na hana desu ne', meaning: 'It\'s a beautiful flower, isn\'t it?', type: 'Grammar' },
            { char: '今日はとても寒いです', kana: 'きょうはとてもさむいです', romaji: 'Kyou wa totemo samui desu', meaning: 'Today is very cold', type: 'Grammar' },
            { char: '静かな部屋が好きです', kana: 'しずかなへやがすきです', romaji: 'Shizuka na heya ga suki desu', meaning: 'I like quiet rooms', type: 'Grammar' },
            { char: '高い時計を買いました', kana: 'たかいとけいをかいました', romaji: 'Takai tokei o kaimashita', meaning: 'I bought an expensive watch', type: 'Grammar' },
            { char: '机の上に本があります', kana: 'つくえのうえにほんがあります', romaji: 'Tsukue no ue ni hon ga arimasu', meaning: 'There is a book on the desk', type: 'Grammar' },
            { char: '庭に猫がいます', kana: 'にわにねこがいます', romaji: 'Niwa ni neko ga imasu', meaning: 'There is a cat in the garden', type: 'Grammar' },
            { char: '先生はどこにいますか？', kana: 'せんせいはどこにいますか？', romaji: 'Sensei wa doko ni imasu ka?', meaning: 'Where is the teacher?', type: 'Grammar' },
            { char: '駅はどこですか？', kana: 'えきはどこですか？', romaji: 'Eki wa doko desu ka?', meaning: 'Where is the station?', type: 'Grammar' },
            { char: '車があります', kana: 'くるまがあります', romaji: 'Kuruma ga arimasu', meaning: 'There is a car', type: 'Grammar' },
            { char: 'ちょっと待ってください', kana: 'ちょっとまってください', romaji: 'Chotto matte kudasai', meaning: 'Please wait a moment', type: 'Grammar' },
            { char: '食べてください', kana: 'たべてください', romaji: 'Tabete kudasai', meaning: 'Please eat', type: 'Grammar' },
            { char: '行ってください', kana: 'いってください', romaji: 'Itte kudasai', meaning: 'Please go', type: 'Grammar' },
            { char: 'テレビを見ています', kana: 'てれびをみています', romaji: 'Terebi o mite imasu', meaning: 'I am watching TV', type: 'Grammar' },
            { char: '水を飲んでください', kana: 'みずをのんでください', romaji: 'Mizu o nonde kudasai', meaning: 'Please drink water', type: 'Grammar' }
        ];

        const particlesData = [
            { char: '私 __ 学生です', sentenceRomaji: 'Watashi __ gakusei desu', romaji: 'は (wa)', meaning: 'I am a student', type: 'Particles' },
            { char: '猫 __ います', sentenceRomaji: 'Neko __ imasu', romaji: 'が (ga)', meaning: 'There is a cat', type: 'Particles' },
            { char: '水 __ 飲みます', sentenceRomaji: 'Mizu __ nomimasu', romaji: 'を (o)', meaning: 'Drink water', type: 'Particles' },
            { char: '日本 __ 行きます', sentenceRomaji: 'Nihon __ ikimasu', romaji: 'に (ni)', meaning: 'Go to Japan', type: 'Particles' },
            { char: 'レストラン __ 食べます', sentenceRomaji: 'Resutoran __ tabemasu', romaji: 'で (de)', meaning: 'Eat at a restaurant', type: 'Particles' },
            { char: '東京 __ 行きます', sentenceRomaji: 'Toukyou __ ikimasu', romaji: 'へ (e)', meaning: 'Go towards Tokyo', type: 'Particles' },
            { char: '私 __ 本です', sentenceRomaji: 'Watashi __ hon desu', romaji: 'の (no)', meaning: 'It is my book', type: 'Particles' },
            { char: '友達 __ 行きます', sentenceRomaji: 'Tomodachi __ ikimasu', romaji: 'と (to)', meaning: 'Go with a friend', type: 'Particles' },
            { char: '私 __ 学生です', sentenceRomaji: 'Watashi __ gakusei desu', romaji: 'も (mo)', meaning: 'I am also a student', type: 'Particles' },
            { char: 'お元気です __', sentenceRomaji: 'Ogenki desu __', romaji: 'か (ka)', meaning: 'Are you well?', type: 'Particles' }
        ];

        const vocabData = [
            // Home
            { char: "家", kana: "いえ", romaji: "ie", meaning: "House", type: 'Vocabulary' },
            { char: "アパート", kana: "あぱーと", romaji: "apaato", meaning: "Apartment", type: 'Vocabulary' },
            { char: "部屋", kana: "へや", romaji: "heya", meaning: "Room", type: 'Vocabulary' },
            { char: "玄関", kana: "げんかん", romaji: "genkan", meaning: "Entrance", type: 'Vocabulary' },
            { char: "居間", kana: "いま", romaji: "ima", meaning: "Living Room", type: 'Vocabulary' },
            { char: "台所", kana: "だいどころ", romaji: "daidokoro", meaning: "Kitchen", type: 'Vocabulary' },
            { char: "寝室", kana: "しんしつ", romaji: "shinshitsu", meaning: "Bedroom", type: 'Vocabulary' },
            { char: "風呂場", kana: "ふろば", romaji: "furoba", meaning: "Bathroom", type: 'Vocabulary' },
            { char: "トイレ", kana: "といれ", romaji: "toire", meaning: "Toilet", type: 'Vocabulary' },
            { char: "庭", kana: "にわ", romaji: "niwa", meaning: "Garden", type: 'Vocabulary' },
            { char: "ベランダ", kana: "べらんだ", romaji: "beranda", meaning: "Balcony", type: 'Vocabulary' },
            { char: "廊下", kana: "ろうか", romaji: "rouka", meaning: "Hallway", type: 'Vocabulary' },
            { char: "階段", kana: "かいだん", romaji: "kaidan", meaning: "Stairs", type: 'Vocabulary' },
            { char: "ドア", kana: "どあ", romaji: "doa", meaning: "Door", type: 'Vocabulary' },
            { char: "窓", kana: "まど", romaji: "mado", meaning: "Window", type: 'Vocabulary' },
            { char: "床", kana: "ゆか", romaji: "yuka", meaning: "Floor", type: 'Vocabulary' },
            { char: "壁", kana: "かべ", romaji: "kabe", meaning: "Wall", type: 'Vocabulary' },
            { char: "天井", kana: "てんじょう", romaji: "tenjou", meaning: "Ceiling", type: 'Vocabulary' },
            { char: "椅子", kana: "いす", romaji: "isu", meaning: "Chair", type: 'Vocabulary' },
            { char: "テーブル", kana: "てーぶる", romaji: "teeburu", meaning: "Table", type: 'Vocabulary' },
            { char: "ソファ", kana: "そふぁ", romaji: "sofa", meaning: "Sofa", type: 'Vocabulary' },
            { char: "ベッド", kana: "べっど", romaji: "beddo", meaning: "Bed", type: 'Vocabulary' },
            { char: "本棚", kana: "ほんだな", romaji: "hondana", meaning: "Bookshelf", type: 'Vocabulary' },
            { char: "机", kana: "つくえ", romaji: "tsukue", meaning: "Desk", type: 'Vocabulary' },
            { char: "戸棚", kana: "とだな", romaji: "todana", meaning: "Cabinet", type: 'Vocabulary' },
            { char: "カーテン", kana: "かーてん", romaji: "kaaten", meaning: "Curtain", type: 'Vocabulary' },
            { char: "鏡", kana: "かがみ", romaji: "kagami", meaning: "Mirror", type: 'Vocabulary' },
            { char: "ゴミ箱", kana: "ごみばこ", romaji: "gomibako", meaning: "Trash Can", type: 'Vocabulary' },
            { char: "テレビ", kana: "てれび", romaji: "terebi", meaning: "TV", type: 'Vocabulary' },
            { char: "冷蔵庫", kana: "れいぞうこ", romaji: "reizouko", meaning: "Refrigerator", type: 'Vocabulary' },
            { char: "洗濯機", kana: "せんたくき", romaji: "sentakuki", meaning: "Washing Machine", type: 'Vocabulary' },
            { char: "電子レンジ", kana: "でんしれんじ", romaji: "denshirenji", meaning: "Microwave", type: 'Vocabulary' },
            { char: "エアコン", kana: "えあこん", romaji: "eakon", meaning: "Air Conditioner", type: 'Vocabulary' },
            { char: "掃除機", kana: "そうじき", romaji: "soujiki", meaning: "Vacuum Cleaner", type: 'Vocabulary' },
            { char: "炊飯器", kana: "すいはんき", romaji: "suihanki", meaning: "Rice Cooker", type: 'Vocabulary' },
            { char: "皿", kana: "さら", romaji: "sara", meaning: "Plate", type: 'Vocabulary' },
            { char: "コップ", kana: "こっぷ", romaji: "koppu", meaning: "Cup", type: 'Vocabulary' },
            { char: "箸", kana: "はし", romaji: "hashi", meaning: "Chopsticks", type: 'Vocabulary' },
            { char: "スプーン", kana: "すぷーん", romaji: "supuun", meaning: "Spoon", type: 'Vocabulary' },
            { char: "フォーク", kana: "ふぉーく", romaji: "fooku", meaning: "Fork", type: 'Vocabulary' },
            { char: "ナイフ", kana: "ないふ", romaji: "naifu", meaning: "Knife", type: 'Vocabulary' },
            { char: "茶碗", kana: "ちゃわん", romaji: "chawan", meaning: "Bowl", type: 'Vocabulary' },
            { char: "鍋", kana: "なべ", romaji: "nabe", meaning: "Pot", type: 'Vocabulary' },
            { char: "フライパン", kana: "ふらいぱん", romaji: "furaipan", meaning: "Frying Pan", type: 'Vocabulary' },
            { char: "タオル", kana: "たおる", romaji: "taoru", meaning: "Towel", type: 'Vocabulary' },
            { char: "石鹸", kana: "せっけん", romaji: "sekken", meaning: "Soap", type: 'Vocabulary' },
            { char: "シャンプー", kana: "しゃんぷー", romaji: "shanpuu", meaning: "Shampoo", type: 'Vocabulary' },
            { char: "歯ブラシ", kana: "はぶらし", romaji: "haburashi", meaning: "Toothbrush", type: 'Vocabulary' },
            { char: "掃除する", kana: "そうじする", romaji: "soujisuru", meaning: "To clean", type: 'Vocabulary' },
            { char: "洗濯する", kana: "せんたくする", romaji: "sentakusuru", meaning: "To do laundry", type: 'Vocabulary' },
            { char: "洗う", kana: "あらう", romaji: "arau", meaning: "To wash", type: 'Vocabulary' },
            { char: "乾かす", kana: "かわかす", romaji: "kawakasu", meaning: "To dry", type: 'Vocabulary' },
            { char: "寝る", kana: "ねる", romaji: "neru", meaning: "To sleep", type: 'Vocabulary' },
            { char: "起きる", kana: "おきる", romaji: "okiru", meaning: "To wake up", type: 'Vocabulary' },
            { char: "電気", kana: "でんき", romaji: "denki", meaning: "Electricity", type: 'Vocabulary' },
            { char: "水道", kana: "すいどう", romaji: "suidou", meaning: "Water (utility)", type: 'Vocabulary' },
            { char: "ガス", kana: "がす", romaji: "gasu", meaning: "Gas", type: 'Vocabulary' },
            { char: "鍵", kana: "かぎ", romaji: "kagi", meaning: "Key", type: 'Vocabulary' },
            { char: "錠", kana: "じょう", romaji: "jou", meaning: "Lock", type: 'Vocabulary' },
            // Family
            { char: "家族", kana: "かぞく", romaji: "kazoku", meaning: "Family", type: 'Vocabulary' },
            { char: "父", kana: "ちち", romaji: "chichi", meaning: "Father", type: 'Vocabulary' },
            { char: "母", kana: "はは", romaji: "haha", meaning: "Mother", type: 'Vocabulary' },
            { char: "兄", kana: "あに", romaji: "ani", meaning: "Older Brother", type: 'Vocabulary' },
            { char: "姉", kana: "あね", romaji: "ane", meaning: "Older Sister", type: 'Vocabulary' },
            { char: "弟", kana: "おとうと", romaji: "otouto", meaning: "Younger Brother", type: 'Vocabulary' },
            { char: "妹", kana: "いもうと", romaji: "imouto", meaning: "Younger Sister", type: 'Vocabulary' },
            { char: "両親", kana: "りょうしん", romaji: "ryoushin", meaning: "Parents", type: 'Vocabulary' },
            { char: "兄弟", kana: "きょうだい", romaji: "kyoudai", meaning: "Siblings", type: 'Vocabulary' },
            { char: "祖父", kana: "そふ", romaji: "sofu", meaning: "Grandfather", type: 'Vocabulary' },
            { char: "祖母", kana: "そぼ", romaji: "sobo", meaning: "Grandmother", type: 'Vocabulary' },
            { char: "叔父", kana: "おじ", romaji: "oji", meaning: "Uncle", type: 'Vocabulary' },
            { char: "叔母", kana: "おば", romaji: "oba", meaning: "Aunt", type: 'Vocabulary' },
            { char: "従兄弟", kana: "いとこ", romaji: "itoko", meaning: "Cousin", type: 'Vocabulary' },
            { char: "夫", kana: "おっと", romaji: "otto", meaning: "Husband", type: 'Vocabulary' },
            { char: "妻", kana: "つま", romaji: "tsuma", meaning: "Wife", type: 'Vocabulary' },
            { char: "結婚", kana: "けっこん", romaji: "kekkon", meaning: "Marriage", type: 'Vocabulary' },
            { char: "独身", kana: "どくしん", romaji: "dokushin", meaning: "Single", type: 'Vocabulary' },
            { char: "お父さん", kana: "おとうさん", romaji: "otousan", meaning: "Father (Polite)", type: 'Vocabulary' },
            { char: "お母さん", kana: "おかあさん", romaji: "okaasan", meaning: "Mother (Polite)", type: 'Vocabulary' },
            { char: "支える", kana: "ささえる", romaji: "sasaeru", meaning: "To support", type: 'Vocabulary' },
            { char: "育てる", kana: "そだてる", romaji: "sodateru", meaning: "To raise", type: 'Vocabulary' },
            // Numbers
            { char: "零", kana: "れい", romaji: "rei", meaning: "Zero", type: 'Vocabulary' },
            { char: "一", kana: "いち", romaji: "ichi", meaning: "One", type: 'Vocabulary' },
            { char: "二", kana: "に", romaji: "ni", meaning: "Two", type: 'Vocabulary' },
            { char: "三", kana: "さん", romaji: "san", meaning: "Three", type: 'Vocabulary' },
            { char: "四", kana: "よん", romaji: "yon", meaning: "Four", type: 'Vocabulary' },
            { char: "五", kana: "ご", romaji: "go", meaning: "Five", type: 'Vocabulary' },
            { char: "六", kana: "ろく", romaji: "roku", meaning: "Six", type: 'Vocabulary' },
            { char: "七", kana: "なな", romaji: "nana", meaning: "Seven", type: 'Vocabulary' },
            { char: "八", kana: "はち", romaji: "hachi", meaning: "Eight", type: 'Vocabulary' },
            { char: "九", kana: "きゅう", romaji: "kyuu", meaning: "Nine", type: 'Vocabulary' },
            { char: "十", kana: "じゅう", romaji: "juu", meaning: "Ten", type: 'Vocabulary' },
            { char: "百", kana: "ひゃく", romaji: "hyaku", meaning: "Hundred", type: 'Vocabulary' },
            { char: "千", kana: "せん", romaji: "sen", meaning: "Thousand", type: 'Vocabulary' },
            { char: "万", kana: "まん", romaji: "man", meaning: "Ten Thousand", type: 'Vocabulary' },
            { char: "一人", kana: "ひとり", romaji: "hitori", meaning: "One Person", type: 'Vocabulary' },
            { char: "二人", kana: "ふたり", romaji: "futari", meaning: "Two People", type: 'Vocabulary' },
            { char: "一台", kana: "いちだい", romaji: "ichidai", meaning: "One Machine", type: 'Vocabulary' },
            { char: "一冊", kana: "いっさつ", romaji: "issatsu", meaning: "One Book", type: 'Vocabulary' },
            { char: "一個", kana: "いっこ", romaji: "ikko", meaning: "One Small Object", type: 'Vocabulary' },
            { char: "一番", kana: "いちばん", romaji: "ichiban", meaning: "Number 1", type: 'Vocabulary' },
            // Clothing
            { char: "服", kana: "ふく", romaji: "fuku", meaning: "Clothes", type: 'Vocabulary' },
            { char: "シャツ", kana: "しゃつ", romaji: "shatsu", meaning: "Shirt", type: 'Vocabulary' },
            { char: "ズボン", kana: "ずぼん", romaji: "zubon", meaning: "Pants", type: 'Vocabulary' },
            { char: "スカート", kana: "すかーと", romaji: "sukaato", meaning: "Skirt", type: 'Vocabulary' },
            { char: "コート", kana: "こーと", romaji: "kooto", meaning: "Coat", type: 'Vocabulary' },
            { char: "靴", kana: "くつ", romaji: "kutsu", meaning: "Shoes", type: 'Vocabulary' },
            { char: "靴下", kana: "くつした", romaji: "kutsushita", meaning: "Socks", type: 'Vocabulary' },
            { char: "帽子", kana: "ぼうし", romaji: "boushi", meaning: "Hat", type: 'Vocabulary' },
            { char: "眼鏡", kana: "めがね", romaji: "megane", meaning: "Glasses", type: 'Vocabulary' },
            { char: "鞄", kana: "かばん", romaji: "kaban", meaning: "Bag", type: 'Vocabulary' },
            { char: "財布", kana: "さいふ", romaji: "saifu", meaning: "Wallet", type: 'Vocabulary' },
            { char: "傘", kana: "かさ", romaji: "kasa", meaning: "Umbrella", type: 'Vocabulary' },
            { char: "着る", kana: "きる", romaji: "kiru", meaning: "To wear (upper)", type: 'Vocabulary' },
            { char: "履く", kana: "はく", romaji: "haku", meaning: "To wear (lower)", type: 'Vocabulary' },
            { char: "被る", kana: "かぶる", romaji: "kaburu", meaning: "To wear (head)", type: 'Vocabulary' },
            { char: "脱ぐ", kana: "ぬぐ", romaji: "nugu", meaning: "To take off", type: 'Vocabulary' },
            { char: "きつい", kana: "きつい", romaji: "kitsui", meaning: "Tight", type: 'Vocabulary' },
            { char: "緩い", kana: "ゆるい", romaji: "yurui", meaning: "Loose", type: 'Vocabulary' },
            { char: "新しい", kana: "あたらしい", romaji: "atarashii", meaning: "New", type: 'Vocabulary' },
            { char: "古い", kana: "ふるい", romaji: "furui", meaning: "Old", type: 'Vocabulary' },
            // Movement
            { char: "行く", kana: "いく", romaji: "iku", meaning: "To go", type: 'Vocabulary' },
            { char: "来る", kana: "くる", romaji: "kuru", meaning: "To come", type: 'Vocabulary' },
            { char: "帰る", kana: "かえる", romaji: "kaeru", meaning: "To return", type: 'Vocabulary' },
            { char: "歩く", kana: "あるく", romaji: "aruku", meaning: "To walk", type: 'Vocabulary' },
            { char: "走る", kana: "はしる", romaji: "hashiru", meaning: "To run", type: 'Vocabulary' },
            { char: "飛ぶ", kana: "とぶ", romaji: "tobu", meaning: "To fly", type: 'Vocabulary' },
            { char: "泳ぐ", kana: "およぐ", romaji: "oyogu", meaning: "To swim", type: 'Vocabulary' },
            { char: "曲がる", kana: "まがる", romaji: "magaru", meaning: "To turn", type: 'Vocabulary' },
            { char: "止まる", kana: "とまる", romaji: "tomaru", meaning: "To stop", type: 'Vocabulary' },
            { char: "右", kana: "みぎ", romaji: "migi", meaning: "Right", type: 'Vocabulary' },
            { char: "左", kana: "ひだり", romaji: "hidari", meaning: "Left", type: 'Vocabulary' },
            { char: "真っ直ぐ", kana: "まっすぐ", romaji: "massugu", meaning: "Straight", type: 'Vocabulary' },
            { char: "上", kana: "うえ", romaji: "ue", meaning: "Up", type: 'Vocabulary' },
            { char: "下", kana: "した", romaji: "shita", meaning: "Down", type: 'Vocabulary' },
            { char: "前", kana: "まえ", romaji: "mae", meaning: "Front", type: 'Vocabulary' },
            { char: "後ろ", kana: "うしろ", romaji: "ushiro", meaning: "Back", type: 'Vocabulary' },
            { char: "外", kana: "そと", romaji: "soto", meaning: "Outside", type: 'Vocabulary' },
            { char: "中", kana: "なか", romaji: "naka", meaning: "Inside", type: 'Vocabulary' },
            { char: "車", kana: "くるま", romaji: "kuruma", meaning: "Car", type: 'Vocabulary' },
            { char: "電車", kana: "でんしゃ", romaji: "densha", meaning: "Train", type: 'Vocabulary' },
            { char: "自転車", kana: "じてんしゃ", romaji: "jitensha", meaning: "Bicycle", type: 'Vocabulary' },
            { char: "バス", kana: "ばす", romaji: "basu", meaning: "Bus", type: 'Vocabulary' },
            { char: "飛行機", kana: "ひこうき", romaji: "hikouki", meaning: "Airplane", type: 'Vocabulary' },
            // Food
            { char: "朝ご飯", kana: "あさごはん", romaji: "asagohan", meaning: "Breakfast", type: 'Vocabulary' },
            { char: "昼ご飯", kana: "ひるごはん", romaji: "hirugohan", meaning: "Lunch", type: 'Vocabulary' },
            { char: "晩ご飯", kana: "ばんごはん", romaji: "bangohan", meaning: "Dinner", type: 'Vocabulary' },
            { char: "肉", kana: "にく", romaji: "niku", meaning: "Meat", type: 'Vocabulary' },
            { char: "野菜", kana: "やさい", romaji: "yasai", meaning: "Vegetable", type: 'Vocabulary' },
            { char: "ご飯", kana: "ごはん", romaji: "gohan", meaning: "Rice/Meal", type: 'Vocabulary' },
            { char: "魚", kana: "さかな", romaji: "sakana", meaning: "Fish", type: 'Vocabulary' },
            { char: "卵", kana: "たまご", romaji: "tamago", meaning: "Egg", type: 'Vocabulary' },
            { char: "果物", kana: "くだもの", romaji: "kudamono", meaning: "Fruit", type: 'Vocabulary' },
            { char: "パン", kana: "ぱん", romaji: "pan", meaning: "Bread", type: 'Vocabulary' },
            { char: "水", kana: "みず", romaji: "mizu", meaning: "Water", type: 'Vocabulary' },
            { char: "お茶", kana: "おちゃ", romaji: "ocha", meaning: "Tea", type: 'Vocabulary' },
            { char: "コーヒー", kana: "こーひー", romaji: "koohii", meaning: "Coffee", type: 'Vocabulary' },
            { char: "牛乳", kana: "ぎゅうにゅう", romaji: "gyuunyuu", meaning: "Milk", type: 'Vocabulary' },
            { char: "お酒", kana: "おさけ", romaji: "osake", meaning: "Alcohol", type: 'Vocabulary' },
            { char: "料理する", kana: "りょうりする", romaji: "ryourisuru", meaning: "To cook", type: 'Vocabulary' },
            { char: "食べる", kana: "たべる", romaji: "taberu", meaning: "To eat", type: 'Vocabulary' },
            { char: "飲む", kana: "のむ", romaji: "nomu", meaning: "To drink", type: 'Vocabulary' },
            { char: "茹でる", kana: "ゆでる", romaji: "yuderu", meaning: "To boil", type: 'Vocabulary' },
            { char: "焼く", kana: "やく", romaji: "yaku", meaning: "To bake/grill", type: 'Vocabulary' },
            { char: "切る", kana: "きる", romaji: "kiru", meaning: "To cut", type: 'Vocabulary' },
            { char: "美味しい", kana: "おいしい", romaji: "oishii", meaning: "Delicious", type: 'Vocabulary' },
            { char: "甘い", kana: "あまい", romaji: "amai", meaning: "Sweet", type: 'Vocabulary' },
            { char: "辛い", kana: "からい", romaji: "karai", meaning: "Spicy", type: 'Vocabulary' },
            { char: "塩辛い", kana: "しおからい", romaji: "shiokarai", meaning: "Salty", type: 'Vocabulary' },
            { char: "苦い", kana: "にがい", romaji: "nigai", meaning: "Bitter", type: 'Vocabulary' },
            // Body
            { char: "体", kana: "からだ", romaji: "karada", meaning: "Body", type: 'Vocabulary' },
            { char: "頭", kana: "あたま", romaji: "atama", meaning: "Head", type: 'Vocabulary' },
            { char: "顔", kana: "かお", romaji: "kao", meaning: "Face", type: 'Vocabulary' },
            { char: "目", kana: "め", romaji: "me", meaning: "Eye", type: 'Vocabulary' },
            { char: "耳", kana: "みみ", romaji: "mimi", meaning: "Ear", type: 'Vocabulary' },
            { char: "口", kana: "くち", romaji: "kuchi", meaning: "Mouth", type: 'Vocabulary' },
            { char: "鼻", kana: "はな", romaji: "hana", meaning: "Nose", type: 'Vocabulary' },
            { char: "手", kana: "て", romaji: "te", meaning: "Hand", type: 'Vocabulary' },
            { char: "足", kana: "あし", romaji: "ashi", meaning: "Foot/Leg", type: 'Vocabulary' },
            { char: "お腹", kana: "おなか", romaji: "onaka", meaning: "Stomach", type: 'Vocabulary' },
            { char: "背中", kana: "せなか", romaji: "senaka", meaning: "Back", type: 'Vocabulary' },
            { char: "病気", kana: "びょうき", romaji: "byouki", meaning: "Sick", type: 'Vocabulary' },
            { char: "風邪", kana: "かぜ", romaji: "kaze", meaning: "Cold", type: 'Vocabulary' },
            { char: "痛い", kana: "いたい", romaji: "itai", meaning: "Painful", type: 'Vocabulary' },
            { char: "薬", kana: "くすり", romaji: "kusuri", meaning: "Medicine", type: 'Vocabulary' },
            { char: "病院", kana: "びょういん", romaji: "byouin", meaning: "Hospital", type: 'Vocabulary' },
            { char: "医者", kana: "いしゃ", romaji: "isha", meaning: "Doctor", type: 'Vocabulary' },
            { char: "休む", kana: "やすむ", romaji: "yasumu", meaning: "To rest", type: 'Vocabulary' },
            // Work
            { char: "仕事", kana: "しごと", romaji: "shigoto", meaning: "Work", type: 'Vocabulary' },
            { char: "会社", kana: "かいしゃ", romaji: "kaisha", meaning: "Company", type: 'Vocabulary' },
            { char: "事務所", kana: "じむしょ", romaji: "jimusho", meaning: "Office", type: 'Vocabulary' },
            { char: "会議", kana: "かいぎ", romaji: "kaigi", meaning: "Meeting", type: 'Vocabulary' },
            { char: "書類", kana: "しょるい", romaji: "shorui", meaning: "Document", type: 'Vocabulary' },
            { char: "電話", kana: "でんわ", romaji: "denwa", meaning: "Telephone", type: 'Vocabulary' },
            { char: "会社員", kana: "かいしゃいん", romaji: "kaishain", meaning: "Company Employee", type: 'Vocabulary' },
            { char: "同僚", kana: "どうりょう", romaji: "douryou", meaning: "Colleague", type: 'Vocabulary' },
            { char: "上司", kana: "じょうし", romaji: "joushi", meaning: "Boss", type: 'Vocabulary' },
            { char: "部下", kana: "ぶか", romaji: "buka", meaning: "Subordinate", type: 'Vocabulary' },
            { char: "働く", kana: "はたらく", romaji: "hataraku", meaning: "To work", type: 'Vocabulary' },
            { char: "報告する", kana: "ほうこくする", romaji: "houkokusuru", meaning: "To report", type: 'Vocabulary' },
            { char: "連絡する", kana: "れんらくする", romaji: "renrakusuru", meaning: "To contact", type: 'Vocabulary' },
            { char: "相談する", kana: "そうだんする", romaji: "soudansuru", meaning: "To discuss", type: 'Vocabulary' },
            // Emotions
            { char: "嬉しい", kana: "うれしい", romaji: "ureshii", meaning: "Happy", type: 'Vocabulary' },
            { char: "楽しい", kana: "たのしい", romaji: "tanoshii", meaning: "Fun", type: 'Vocabulary' },
            { char: "好き", kana: "すき", romaji: "suki", meaning: "Like", type: 'Vocabulary' },
            { char: "大好き", kana: "だいすき", romaji: "daisuki", meaning: "Love", type: 'Vocabulary' },
            { char: "面白い", kana: "おもしろい", romaji: "omoshiroi", meaning: "Interesting", type: 'Vocabulary' },
            { char: "悲しい", kana: "かなしい", romaji: "kanashii", meaning: "Sad", type: 'Vocabulary' },
            { char: "寂しい", kana: "さびしい", romaji: "sabishii", meaning: "Lonely", type: 'Vocabulary' },
            { char: "嫌い", kana: "きらい", romaji: "kirai", meaning: "Hate", type: 'Vocabulary' },
            { char: "怖い", kana: "こわい", romaji: "kowai", meaning: "Scary", type: 'Vocabulary' },
            { char: "笑う", kana: "わらう", romaji: "warau", meaning: "To laugh", type: 'Vocabulary' },
            { char: "泣く", kana: "なく", romaji: "naku", meaning: "To cry", type: 'Vocabulary' },
            { char: "怒る", kana: "おこる", romaji: "okoru", meaning: "To get angry", type: 'Vocabulary' },
            { char: "心配する", kana: "しんぱいする", romaji: "shinpaisuru", meaning: "To worry", type: 'Vocabulary' },
            // Technology
            { char: "パソコン", kana: "ぱそこん", romaji: "pasokon", meaning: "Computer", type: 'Vocabulary' },
            { char: "スマホ", kana: "すまほ", romaji: "sumaho", meaning: "Smartphone", type: 'Vocabulary' },
            { char: "携帯電話", kana: "けいたいでんわ", romaji: "keitaidenwa", meaning: "Mobile Phone", type: 'Vocabulary' },
            { char: "タブレット", kana: "たぶれっと", romaji: "taburetto", meaning: "Tablet", type: 'Vocabulary' },
            { char: "カメラ", kana: "かめら", romaji: "kamera", meaning: "Camera", type: 'Vocabulary' },
            { char: "インターネット", kana: "いんたーねっと", romaji: "intaanetto", meaning: "Internet", type: 'Vocabulary' },
            { char: "メール", kana: "めーる", romaji: "meeru", meaning: "Email", type: 'Vocabulary' },
            { char: "ウェブサイト", kana: "うぇぶさいと", romaji: "webusaito", meaning: "Website", type: 'Vocabulary' },
            { char: "パスワード", kana: "ぱすわーど", romaji: "pasuwaado", meaning: "Password", type: 'Vocabulary' },
            { char: "使う", kana: "つかう", romaji: "tsukau", meaning: "To use", type: 'Vocabulary' },
            { char: "送る", kana: "おくる", romaji: "okuru", meaning: "To send", type: 'Vocabulary' },
            { char: "ダウンロードする", kana: "だうんろーどする", romaji: "daunroodosuru", meaning: "To download", type: 'Vocabulary' },
            { char: "検索する", kana: "けんさくする", romaji: "kensakusuru", meaning: "To search", type: 'Vocabulary' },
            { char: "クリックする", kana: "くりっくする", romaji: "kurikkusuru", meaning: "To click", type: 'Vocabulary' },
            { char: "ログインする", kana: "ろぐいんする", romaji: "roguinsuru", meaning: "To login", type: 'Vocabulary' }
        ];



        let currentPool = [];
        let currentItem = null;
        let currentModule = '';
        // allKanjiList is declared above

        async function fetchJoyoKanji() {
            try {
                const response = await fetch('https://kanjiapi.dev/v1/kanji/joyo');
                const data = await response.json();
                allKanjiList = data;
                console.log(`Loaded ${allKanjiList.length} Kanji characters.`);
            } catch (error) {
                console.error("Failed to fetch Kanji list", error);
                // Fallback
                allKanjiList = ['日', '月', '火', '水', '木', '金', '土', '山', '川', '田'];
            }
        }

        function toRomaji(text) {
            if (!text) return '';
            let result = '';
            let i = 0;
            const combined = [...hiraganaData, ...katakanaData];

            while (i < text.length) {
                let found = false;
                // Try 2 characters first (for Yoon)
                if (i + 1 < text.length) {
                    const pair = text.substring(i, i + 2);
                    const match = combined.find(d => d.char === pair);
                    if (match) {
                        result += (result && !result.endsWith(' ') ? '' : '') + match.romaji;
                        i += 2;
                        found = true;
                    }
                }

                if (!found) {
                    const char = text[i];
                    const match = combined.find(d => d.char === char);
                    if (match) {
                        result += match.romaji;
                    } else {
                        result += char;
                    }
                    i++;
                }
            }
            return result;
        }

        async function getKanjiDetails(char) {
            if (kanjiData[char]) return kanjiData[char];

            try {
                const response = await fetch(`https://kanjiapi.dev/v1/kanji/${char}`);
                const data = await response.json();

                const details = {
                    char: data.kanji,
                    kana: `On: ${data.on_readings.join(', ')} \n Kun: ${data.kun_readings.join(', ')}`,
                    romaji: `On: ${data.on_readings.map(toRomaji).join(', ')} \n Kun: ${data.kun_readings.map(toRomaji).join(', ')}`,
                    meaning: data.meanings.join(', '),
                    type: 'Kanji'
                };
                kanjiData[char] = details;
                return details;
            } catch (error) {
                console.error(`Error fetching details for ${char}:`, error);
                return {
                    char: char,
                    kana: 'Unknown',
                    romaji: 'Unknown',
                    meaning: 'Could not load details',
                    type: 'Kanji'
                };
            }
        }

        function switchModule(module, btn) {
            // Update UI
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');

            const area = document.getElementById('challenge-area');
            area.classList.add('active');

            currentModule = module;
            document.getElementById('current-module-title').textContent = module.charAt(0).toUpperCase() + module.slice(1) + ' Challenge';

            if (module === 'hiragana') currentPool = [...hiraganaData];
            else if (module === 'katakana') currentPool = [...katakanaData];
            else if (module === 'vocabulary') currentPool = [...vocabData];
            else if (module === 'grammar') currentPool = [...grammarData];
            else if (module === 'particles') currentPool = [...particlesData];
            else if (module === 'kanji') {
                currentPool = allKanjiList; // The pool is the list of characters
            }
            else if (module === 'all') {
                // For 'all', we mix data. For Kanji, we'll just add a placeholder string 'KANJI_RANDOM' 
                // multiple times to give it weight
                currentPool = [
                    ...hiraganaData,
                    ...katakanaData,
                    ...vocabData,
                    ...grammarData,
                    ...particlesData
                ];
                // Add some random Kanji placeholders to the mix (e.g., 50 slots)
                if (allKanjiList.length > 0) {
                    for (let i = 0; i < 50; i++) currentPool.push('KANJI_RANDOM');
                }
            }

            nextCard();
        }

        async function nextCard() {
            const card = document.getElementById('flashcard');
            card.classList.remove('flipped');

            setTimeout(async () => {
                if (currentPool.length === 0) {
                    if (currentModule === 'kanji') {
                        document.getElementById('card-front-main').textContent = 'Loading...';
                        document.getElementById('card-front-sub').textContent = 'Fetching Kanji data...';
                    }
                    return;
                }

                const randomIndex = Math.floor(Math.random() * currentPool.length);
                let selectedItem = currentPool[randomIndex];

                // Handle Kanji (Lazy Loading)
                if (currentModule === 'kanji' || selectedItem === 'KANJI_RANDOM') {
                    let charToFetch = selectedItem;

                    if (currentModule === 'kanji') {
                        // selectedItem is the character itself
                        charToFetch = selectedItem;
                    } else if (selectedItem === 'KANJI_RANDOM') {
                        // Pick a random kanji from the full list
                        if (allKanjiList.length > 0) {
                            charToFetch = allKanjiList[Math.floor(Math.random() * allKanjiList.length)];
                        } else {
                            // Fallback if list not loaded yet
                            charToFetch = '日';
                        }
                    }

                    // Show loading state
                    document.getElementById('card-module').textContent = 'Kanji';
                    document.getElementById('card-front-main').textContent = charToFetch;
                    document.getElementById('card-front-sub').textContent = 'Loading details...';
                    document.getElementById('card-back-main').textContent = '...';
                    document.getElementById('card-back-sub').textContent = '...';

                    // Fetch details
                    currentItem = await getKanjiDetails(charToFetch);
                } else {
                    currentItem = selectedItem;
                }

                // Update UI with currentItem details
                document.getElementById('card-module').textContent = currentItem.type;

                const frontMain = document.getElementById('card-front-main');
                const frontSub = document.getElementById('card-front-sub');
                const backMain = document.getElementById('card-back-main');
                const backSub = document.getElementById('card-back-sub');

                frontMain.textContent = currentItem.char;

                // Reset styles
                frontMain.style.fontSize = '';
                backMain.style.fontSize = '';

                // Contextual sub-text and font sizing
                if (currentItem.type === 'Grammar') {
                    frontSub.textContent = 'Translate this sentence';
                    frontMain.style.fontSize = '1.8rem';

                    // Back: Romaji <br> Kana <br> Meaning
                    backMain.innerHTML = `${currentItem.romaji}<br><span style="font-size: 0.6em; color: rgba(255,255,255,0.8); font-weight: normal;">${currentItem.kana || ''}</span>`;
                    backSub.textContent = currentItem.meaning;

                } else if (currentItem.type === 'Particles') {
                    // Front: Sentence <br> Romaji Subtitle
                    frontSub.innerHTML = `${currentItem.sentenceRomaji || ''}<br><span style="font-size:0.7em; opacity: 0.8;">Which particle fits?</span>`;
                    frontMain.style.fontSize = '2.5rem';

                    backMain.textContent = currentItem.romaji;
                    backSub.textContent = currentItem.meaning;

                } else if (currentItem.type === 'Vocabulary') {
                    frontSub.textContent = 'What is the meaning?';
                    frontMain.style.fontSize = currentItem.char.length > 5 ? '2.5rem' : '4rem';

                    // Back: Romaji <br> Kana <br> Meaning
                    backMain.innerHTML = `${currentItem.romaji}<br><span style="font-size: 0.6em; color: rgba(255,255,255,0.8); font-weight: normal;">${currentItem.kana || ''}</span>`;
                    backSub.textContent = currentItem.meaning;

                } else if (currentItem.type === 'Kanji') {
                    frontSub.textContent = 'Readings & Meaning?';
                    frontMain.style.fontSize = '6rem';

                    // Back: Readings (Kana) <br> Romaji <br> Meaning
                    // No Kanji character on back as requested
                    backMain.innerHTML = `<span style="font-size: 0.7em; line-height: 1.2; display: block;">${currentItem.kana.replace(/\n/g, '<br>')}</span><span style="font-size: 0.5em; display: block; margin-top: 0.5rem; color: rgba(255,255,255,0.7); font-weight: normal;">${currentItem.romaji.replace(/\n/g, '<br>')}</span>`;
                    backSub.textContent = currentItem.meaning;
                    backMain.style.fontSize = '2.5rem';

                } else {
                    // Hiragana / Katakana
                    frontSub.textContent = 'What is the meaning?';
                    frontMain.style.fontSize = '6rem';

                    backMain.textContent = currentItem.romaji;
                    backSub.textContent = currentItem.meaning;
                    backMain.style.fontSize = '3.5rem';
                }

                // Adjust back font size for non-Kanji/Grammar/Vocab if needed
                if (currentItem.type !== 'Kanji' && currentItem.type !== 'Grammar' && currentItem.type !== 'Vocabulary') {
                    if (currentItem.romaji.length > 20) {
                        backMain.style.fontSize = '1.2rem';
                    } else if (currentItem.romaji.length > 10) {
                        backMain.style.fontSize = '1.8rem';
                    }
                }

                // Specific adjustments for Grammar back text size
                if (currentItem.type === 'Grammar') {
                    backMain.style.fontSize = '2rem';
                }

                // Vocabulary now matches others (3.5rem) as requested
                if (currentItem.type === 'Vocabulary') {
                    backMain.style.fontSize = '3.5rem';
                }

            }, card.classList.contains('flipped') ? 300 : 0);
        }

        function flipCard() {
            if (!currentModule) return;
            document.getElementById('flashcard').classList.toggle('flipped');
        }

        // Initialize with All Challenge
        window.onload = () => {
            const firstBtn = document.querySelector('.nav-btn'); // "All Challenge" is first
            fetchJoyoKanji(); // Start fetching kanji in background
            switchModule('all', firstBtn);
        };
    </script>
</body>

</html>