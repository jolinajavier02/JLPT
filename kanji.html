<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learn Kanji - Notesjp</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Noto+Sans+JP:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            overflow-x: hidden;
            min-height: 100vh;
            background: #f8f9fa;
        }

        /* Grid View (Scrollable) */
        .grid-view {
            min-height: 100vh;
            overflow-y: auto;
            padding: 80px 1rem 4rem;
            display: none;
            background: white;
        }

        .grid-view.active {
            display: block;
        }

        /* Detail View (Fixed Single Card) */
        .detail-view {
            display: none;
            height: 100vh;
            width: 100vw;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
        }

        .detail-view.active {
            display: flex;
        }

        .detail-card {
            background: white;
            border-radius: 24px;
            box-shadow: var(--shadow-lg);
            width: 95%;
            max-width: 1000px;
            height: 90vh;
            max-height: 700px;
            display: grid;
            grid-template-columns: 35% 65%;
            /* Left: Kanji, Right: Info */
            grid-template-rows: 1fr;
            overflow: hidden;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        /* Left Column: Kanji Display */
        .card-left {
            background: var(--primary-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            padding: 2rem;
            position: relative;
        }

        .detail-char {
            font-size: 12rem;
            font-family: var(--font-jp);
            font-weight: 700;
            line-height: 1;
        }

        .detail-meaning {
            font-size: 2.5rem;
            font-weight: 800;
            margin-top: 1rem;
            text-align: center;
            text-transform: capitalize;
        }

        /* Right Column: Info & Interactive */
        .card-right {
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            overflow-y: auto;
            justify-content: center;
        }

        /* Readings Section */
        .readings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .reading-box {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 12px;
            border-left: 4px solid var(--accent-color);
        }

        .reading-label {
            font-size: 0.75rem;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.25rem;
            display: block;
        }

        .reading-value {
            font-size: 1.1rem;
            color: var(--text-color);
            font-weight: 600;
            font-family: var(--font-jp);
        }





        /* Stroke Order Box */
        .stroke-box {
            background: white;
            border: 2px dashed #ddd;
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .stroke-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stroke-placeholder svg {
            width: 80%;
            height: 80%;
        }

        .stroke-placeholder path {
            stroke: var(--primary-color) !important;
            stroke-width: 4 !important;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: draw 2s linear forwards;
        }

        @keyframes draw {
            to {
                stroke-dashoffset: 0;
            }
        }

        /* Navigation */
        .card-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }

        .nav-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            transition: 0.2s;
            padding: 0.5rem;
        }

        .nav-btn:hover {
            color: var(--primary-color);
            transform: scale(1.1);
        }

        .close-btn {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: 0.2s;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.4);
        }

        /* Search & Grid Styles (Reused) */
        .kanji-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 1rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .kanji-card {
            background: white;
            padding: 1rem;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-family: var(--font-jp);
            font-weight: 700;
        }

        .kanji-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
            background: var(--primary-color);
            color: white;
        }

        .search-container {
            max-width: 600px;
            margin: 0 auto 2rem;
        }

        .search-input {
            width: 100%;
            padding: 1rem 1.5rem;
            border-radius: 50px;
            border: 2px solid #eee;
            font-size: 1rem;
            outline: none;
        }

        .search-input:focus {
            border-color: var(--primary-color);
        }

        .load-more-btn {
            display: block;
            margin: 3rem auto;
            background: var(--primary-color);
            border: none;
            color: white;
            padding: 1rem 3rem;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-md);
        }

        .load-more-btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Responsive */
        @media (max-width: 900px) {
            .detail-card {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
                height: 95vh;
                overflow-y: auto;
            }

            .card-left {
                padding: 1.5rem;
                flex-direction: row;
                gap: 1rem;
                justify-content: flex-start;
            }

            .detail-char {
                font-size: 4rem;
            }

            .detail-meaning {
                font-size: 1.5rem;
                margin: 0;
            }

            .visual-grid {
                grid-template-columns: 1fr;
            }

            .close-btn {
                color: var(--text-color);
                top: 1rem;
                right: 1rem;
                background: #eee;
            }
        }
    </style>
</head>

<body>

    <header class="main-header">
        <div class="container">
            <nav>
                <a href="home.html" class="logo">Notesjp</a>
                <div class="nav-links">
                    <a href="home.html" class="nav-link">Dashboard</a>
                    <a href="test.html" class="header-btn">Take Test</a>
                </div>
            </nav>
        </div>
    </header>

    <!-- Grid View -->
    <div id="grid-view" class="grid-view active">
        <div class="container">
            <div style="text-align: center; margin-bottom: 2rem;">
                <h1>Kanji Library</h1>
                <p>Explore JLPT N5-N1 Kanji (2,016 characters)</p>
            </div>

            <!-- Thematic Sets -->
            <div class="thematic-sets" style="margin-bottom: 3rem;">

                <div id="loading-indicator" class="loading-spinner" style="margin: 2rem auto;"></div>
                <div class="kanji-grid" id="kanji-grid"></div>
                <button id="load-more" class="load-more-btn" onclick="loadMoreKanji()" style="display: none;">Load
                    More</button>
            </div>
        </div>

        <!-- Detail View (Single Card Overlay) -->
        <div id="detail-view" class="detail-view">
            <div class="detail-card">

                <!-- Left: Character -->
                <div class="card-left">
                    <span id="detail-char" class="detail-char">?</span>
                    <span id="detail-meaning" class="detail-meaning">Loading...</span>
                    <button class="close-btn" onclick="showGrid()">✕</button>
                </div>

                <!-- Right: Info -->
                <div class="card-right">

                    <!-- Readings -->
                    <div class="readings-grid">
                        <div class="reading-box">
                            <span class="reading-label">Onyomi</span>
                            <div id="detail-onyomi" class="reading-value">-</div>
                        </div>
                        <div class="reading-box">
                            <span class="reading-label">Kunyomi</span>
                            <div id="detail-kunyomi" class="reading-value">-</div>
                        </div>
                    </div>

                    <!-- Writing Pattern -->
                    <div class="stroke-box" style="width: 100%; max-width: 300px; margin: 0 auto; aspect-ratio: 1/1;">
                        <span class="reading-label" style="position: absolute; top: 0.5rem; left: 1rem;">Writing
                            Pattern</span>
                        <div class="stroke-placeholder" id="stroke-container">
                            Loading...
                        </div>
                        <button class="btn"
                            style="position: absolute; bottom: 0.5rem; right: 0.5rem; padding: 0.25rem 0.75rem; font-size: 0.7rem;"
                            onclick="replayAnimation()">Replay</button>
                    </div>

                    <!-- Navigation -->
                    <div class="card-nav">
                        <button class="nav-btn" onclick="prevChar()">← Previous</button>
                        <button class="nav-btn" onclick="nextChar()">Next →</button>
                    </div>

                </div>
            </div>
        </div>

        <script>
            // State
            let allKanjiList = [];
            let displayedCount = 0;
            const BATCH_SIZE = 100;
            let currentKanjiIndex = 0;

            // Kana Map (Same as before)
            const kanaMap = {
                'あ': 'a', 'い': 'i', 'う': 'u', 'え': 'e', 'お': 'o', 'か': 'ka', 'き': 'ki', 'く': 'ku', 'け': 'ke', 'こ': 'ko',
                'さ': 'sa', 'し': 'shi', 'す': 'su', 'せ': 'se', 'そ': 'so', 'た': 'ta', 'ち': 'chi', 'つ': 'tsu', 'て': 'te', 'と': 'to',
                'な': 'na', 'に': 'ni', 'ぬ': 'nu', 'ね': 'ne', 'の': 'no', 'は': 'ha', 'ひ': 'hi', 'ふ': 'fu', 'へ': 'he', 'ほ': 'ho',
                'ま': 'ma', 'み': 'mi', 'む': 'mu', 'め': 'me', 'も': 'mo', 'や': 'ya', 'ゆ': 'yu', 'よ': 'yo',
                'ら': 'ra', 'り': 'ri', 'る': 'ru', 'れ': 're', 'ろ': 'ro', 'わ': 'wa', 'を': 'wo', 'ん': 'n',
                'が': 'ga', 'ぎ': 'gi', 'ぐ': 'gu', 'げ': 'ge', 'ご': 'go', 'ざ': 'za', 'じ': 'ji', 'ず': 'zu', 'ぜ': 'ze', 'ぞ': 'zo',
                'だ': 'da', 'ぢ': 'ji', 'づ': 'zu', 'で': 'de', 'ど': 'do', 'ば': 'ba', 'び': 'bi', 'ぶ': 'bu', 'べ': 'be', 'ぼ': 'bo',
                'ぱ': 'pa', 'ぴ': 'pi', 'ぷ': 'pu', 'ぺ': 'pe', 'ぽ': 'po', 'きゃ': 'kya', 'きゅ': 'kyu', 'きょ': 'kyo',
                'しゃ': 'sha', 'しゅ': 'shu', 'しょ': 'sho', 'ちゃ': 'cha', 'ちゅ': 'chu', 'ちょ': 'cho',
                'にゃ': 'nya', 'にゅ': 'nyu', 'にょ': 'nyo', 'ひゃ': 'hya', 'ひゅ': 'hyu', 'ひょ': 'hyo',
                'みゃ': 'mya', 'みゅ': 'myu', 'みょ': 'myo', 'りゃ': 'rya', 'りゅ': 'ryu', 'りょ': 'ryo',
                'ぎゃ': 'gya', 'ぎゅ': 'gyu', 'ぎょ': 'gyo', 'じゃ': 'ja', 'じゅ': 'ju', 'じょ': 'jo',
                'びゃ': 'bya', 'びゅ': 'byu', 'びょ': 'byo', 'ぴゃ': 'pya', 'ぴゅ': 'pyu', 'ぴょ': 'pyo',
                'ア': 'a', 'イ': 'i', 'ウ': 'u', 'エ': 'e', 'オ': 'o', 'カ': 'ka', 'キ': 'ki', 'ク': 'ku', 'ケ': 'ke', 'コ': 'ko',
                'サ': 'sa', 'シ': 'shi', 'ス': 'su', 'セ': 'se', 'ソ': 'so', 'タ': 'ta', 'チ': 'chi', 'ツ': 'tsu', 'テ': 'te', 'ト': 'to',
                'ナ': 'na', 'ニ': 'ni', 'ヌ': 'nu', 'ネ': 'ne', 'ノ': 'no', 'ハ': 'ha', 'ヒ': 'hi', 'フ': 'fu', 'ヘ': 'he', 'ホ': 'ho',
                'マ': 'ma', 'ミ': 'mi', 'ム': 'mu', 'メ': 'me', 'モ': 'mo', 'ヤ': 'ya', 'ユ': 'yu', 'ヨ': 'yo',
                'ラ': 'ra', 'リ': 'ri', 'ル': 'ru', 'レ': 're', 'ロ': 'ro', 'ワ': 'wa', 'ヲ': 'wo', 'ン': 'n',
                'ガ': 'ga', 'ギ': 'gi', 'グ': 'gu', 'ゲ': 'ge', 'ゴ': 'go', 'ザ': 'za', 'ジ': 'ji', 'ズ': 'zu', 'ゼ': 'ze', 'ゾ': 'zo',
                'ダ': 'da', 'ヂ': 'ji', 'ヅ': 'zu', 'デ': 'de', 'ド': 'do', 'バ': 'ba', 'ビ': 'bi', 'ブ': 'bu', 'ベ': 'be', 'ボ': 'bo',
                'パ': 'pa', 'ピ': 'pi', 'プ': 'pu', 'ペ': 'pe', 'ポ': 'po', 'キャ': 'kya', 'キュ': 'kyu', 'キョ': 'kyo',
                'シャ': 'sha', 'シュ': 'shu', 'ショ': 'sho', 'チャ': 'cha', 'チュ': 'chu', 'チョ': 'cho',
                'ニャ': 'nya', 'ニュ': 'nyu', 'ニョ': 'nyo', 'ヒャ': 'hya', 'ヒュ': 'hyu', 'ヒョ': 'hyo',
                'ミャ': 'mya', 'ミュ': 'myu', 'ミョ': 'myo', 'リャ': 'rya', 'リュ': 'ryu', 'リョ': 'ryo',
                'ギャ': 'gya', 'ギュ': 'gyu', 'ギョ': 'gyo', 'ジャ': 'ja', 'ジュ': 'ju', 'ジョ': 'jo',
                'ビャ': 'bya', 'ビュ': 'byu', 'ビョ': 'byo', 'ピャ': 'pya', 'ピュ': 'pyu', 'ピョ': 'pyo',
                'ッ': '(pause)', 'っ': '(pause)', 'ー': '-'
            };

            function toRomaji(text) {
                if (!text) return '';
                let romaji = '';
                let i = 0;
                while (i < text.length) {
                    if (i + 1 < text.length) {
                        const two = text.substring(i, i + 2);
                        if (kanaMap[two]) { romaji += kanaMap[two]; i += 2; continue; }
                    }
                    const char = text[i];
                    romaji += kanaMap[char] ? kanaMap[char] : char;
                    i++;
                }
                return romaji;
            }



            document.addEventListener('DOMContentLoaded', () => { loadJLPTKanji(); });

            function loadJLPTKanji() {
                // JLPT N5-N1 Kanji List
                allKanjiList = [
                    // N5 Kanji
                    '一', '二', '三', '四', '五', '六', '七', '八', '九', '十', '人', '今', '日',
                    '週', '月', '年', '中', '山', '川', '左', '右', '大', '木', '本', '水', '火',
                    '父', '母', '耳', '口', '休', '何', '入', '上', '前', '下', '千', '午', '友',
                    '古', '名', '国', '外', '女', '男', '子', '学', '生', '小', '書', '毎', '先',
                    '会', '万', '円', '出', '分', '北', '半', '南', '土', '多', '天', '安', '少',
                    '店', '後', '手', '新', '時', '来', '東', '校', '気', '白', '百', '目', '社',
                    '空', '立', '聞', '花', '行', '西', '見', '言', '話', '語', '読', '買', '足',
                    '車', '道', '金', '長', '間', '雨', '電', '食', '飲', '駅', '高', '魚',

                    // N4 Kanji
                    '力', '夕', '工', '元', '止', '引', '牛', '区', '犬', '不', '文', '方', '心',
                    '切', '太', '代', '台', '世', '正', '田', '冬', '民', '用', '兄', '以', '去',
                    '仕', '市', '広', '主', '写', '字', '自', '考', '合', '光', '好', '死', '回',
                    '有', '同', '肉', '色', '早', '地', '池', '村', '体', '町', '低', '弟', '走',
                    '赤', '図', '究', '声', '売', '別', '医', '近', '私', '作', '住', '者', '事',
                    '使', '始', '姉', '英', '京', '画', '妹', '味', '服', '物', '歩', '門', '夜',
                    '明', '林', '青', '所', '注', '知', '昼', '茶', '待', '洗', '送', '品', '洋',
                    '便', '風', '発', '度', '映', '海', '界', '屋', '音', '急', '計', '建', '研',
                    '県', '思', '乗', '重', '春', '室', '持', '首', '秋', '借', '弱', '紙', '帰',
                    '起', '夏', '家', '院', '員', '病', '勉', '特', '旅', '料', '真', '通', '鳥',
                    '転', '族', '進', '理', '野', '問', '都', '堂', '動', '悪', '強', '教', '産',
                    '黒', '菜', '終', '習', '集', '場', '寒', '軽', '運', '開', '飯', '答', '森',
                    '暑', '朝', '貸', '着', '短', '働', '楽', '暗', '意', '遠', '漢', '業', '試',
                    '銀', '歌', '説', '質', '館', '親', '頭', '薬', '曜', '題', '顔', '験',

                    // N3 Kanji
                    '丸', '久', '才', '支', '戸', '欠', '王', '化', '内', '反', '比', '夫', '仏',
                    '毛', '予', '由', '未', '布', '包', '末', '平', '辺', '氷', '付', '皮', '犯',
                    '必', '石', '他', '打', '加', '可', '央', '刊', '玉', '旧', '号', '皿', '札',
                    '史', '失', '示', '申', '礼', '令', '列', '老', '式', '州', '寺', '次', '守',
                    '糸', '在', '再', '向', '交', '血', '件', '共', '曲', '各', '印', '因', '羽',
                    '団', '竹', '仲', '虫', '兆', '伝', '当', '成', '全', '争', '任', '米', '両',
                    '利', '余', '防', '役', '返', '判', '臣', '身', '折', '努', '投', '対', '束',
                    '谷', '位', '囲', '完', '角', '快', '改', '技', '局', '君', '均', '形', '決',
                    '芸', '求', '希', '告', '材', '坂', '似', '児', '状', '初', '助', '労', '冷',
                    '例', '和', '述', '承', '招', '実', '取', '治', '受', '周', '妻', '参', '枝',
                    '刷', '効', '幸', '固', '季', '岸', '岩', '泣', '協', '居', '苦', '具', '果',
                    '河', '官', '委', '易', '育', '泳', '直', '定', '底', '的', '性', '昔', '制',
                    '卒', '非', '波', '板', '版', '念', '武', '表', '命', '府', '放', '法', '油',
                    '勇', '要', '負', '迷', '約', '面', '変', '飛', '美', '独', '則', '相', '草',
                    '祖', '信', '政', '星', '点', '追', '単', '炭', '退', '栄', '科', '活', '胃',
                    '級', '軍', '係', '型', '客', '逆', '限', '厚', '指', '昨', '祝', '神', '査',
                    '省', '酒', '笑', '消', '師', '財', '殺', '差', '残', '航', '根', '個', '候',
                    '庫', '記', '訓', '害', '格', '荷', '帯', '島', '庭', '徒', '席', '息', '造',
                    '孫', '速', '能', '配', '倍', '破', '馬', '浴', '容', '流', '留', '連', '陸',
                    '率', '略', '望', '務', '敗', '部', '副', '婦', '側', '組', '責', '接', '船',
                    '商', '設', '雪', '清', '深', '得', '第', '停', '断', '貨', '液', '移', '経',
                    '規', '寄', '許', '球', '救', '険', '現', '混', '祭', '細', '術', '宿', '章',
                    '常', '情', '植', '順', '象', '焼', '勝', '歯', '最', '散', '港', '検', '湖',
                    '期', '喜', '結', '景', '給', '雲', '営', '温', '過', '絵', '階', '覚', '貯',
                    '達', '測', '童', '等', '湯', '登', '程', '絶', '然', '富', '復', '費', '番',
                    '悲', '筆', '備', '貿', '無', '報', '満', '量', '遊', '落', '陽', '葉', '税',
                    '路', '豊', '夢', '農', '続', '損', '想', '戦', '勢', '数', '置', '鉄', '感',
                    '解', '園', '愛', '塩', '極', '禁', '罪', '資', '準', '種', '雑', '際', '算',
                    '察', '構', '関', '境', '漁', '演', '慣', '管', '銅', '適', '精', '製', '静',
                    '像', '増', '総', '鼻', '複', '鳴', '綿', '様', '領', '緑', '練', '歴', '輪',
                    '編', '箱', '熱', '選', '線', '導', '談', '調', '横', '確', '課', '器', '賛',
                    '賞', '機', '橋', '築', '積', '輸', '録', '績', '講', '職', '観', '額', '類',
                    '願', '識', '競', '議',

                    // N2 Kanji
                    '了', '与', '亡', '干', '介', '互', '公', '双', '片', '匹', '払', '幼', '庁',
                    '占', '込', '冊', '司', '処', '収', '召', '巨', '甘', '圧', '永', '衣', '汚',
                    '汗', '危', '宇', '灰', '仮', '叫', '机', '吸', '舟', '宅', '存', '忙', '灯',
                    '肌', '否', '抜', '沈', '戻', '坊', '兵', '麦', '批', '乱', '卵', '忘', '良',
                    '伸', '辛', '吹', '床', '条', '志', '伺', '困', '含', '更', '迎', '貝', '応',
                    '押', '欧', '延', '依', '拡', '価', '券', '肩', '呼', '肯', '祈', '供', '況',
                    '刺', '刻', '昇', '若', '姓', '担', '宙', '怖', '並', '沸', '宝', '抱', '枚',
                    '泥', '毒', '突', '届', '彼', '拝', '杯', '泊', '到', '乳', '逃', '背', '畑',
                    '怒', '珍', '保', '秒', '封', '律', '柱', '段', '城', '専', '泉', '浅', '柔',
                    '拾', '咲', '紅', '香', '砂', '狭', '挟', '荒', '郊', '故', '枯', '皆', '革',
                    '看', '巻', '案', '軒', '原', '恵', '降', '胸', '恐', '座', '耕', '骨', '脂',
                    '修', '純', '将', '捜', '除', '針', '値', '恥', '畜', '涙', '恋', '粉', '浮',
                    '疲', '被', '途', '捕', '眠', '娘', '埋', '展', '倒', '党', '凍', '般', '悩',
                    '盗', '脳', '猫', '軟', '販', '訪', '符', '貧', '閉', '粒', '涼', '欲', '翌',
                    '郵', '紹', '頂', '著', '張', '袋', '探', '掃', '窓', '授', '捨', '婚', '採',
                    '済', '偶', '掘', '康', '健', '異', '黄', '乾', '基', '域', '械', '菓', '割',
                    '換', '奥', '偉', '越', '敬', '減', '雇', '硬', '御', '隅', '勤', '喫', '湿',
                    '詞', '畳', '装', '善', '晴', '尊', '替', '超', '遅', '絡', '湾', '腕', '幅',
                    '普', '評', '帽', '補', '募', '棒', '晩', '鈍', '塔', '筒', '痛', '渡', '殿',
                    '塗', '賃', '福', '腹', '零', '裏', '溶', '預', '暖', '節', '寝', '蒸', '触',
                    '照', '署', '辞', '腰', '歳', '詰', '靴', '群', '傾', '鉱', '違', '煙', '較',
                    '誤', '疑', '誌', '緒', '憎', '層', '踊', '暮', '滴', '認', '髪', '暴', '標',
                    '膚', '舞', '論', '蔵', '駐', '震', '諸', '劇', '権', '億', '鋭', '賢', '整',
                    '操', '頼', '壁', '磨', '薄', '燃', '濃', '曇', '優', '齢', '療', '燥', '濯',
                    '環', '簡', '贈', '難', '爆', '臓', '警',

                    // N1 Kanji
                    '乙', '丁', '刀', '又', '凡', '寸', '及', '弓', '己', '士', '丈', '刃', '冗',
                    '升', '尺', '氏', '幻', '孔', '凶', '斤', '井', '刈', '仁', '斗', '爪', '屯',
                    '弔', '丹', '勿', '尤', '厄', '匂', '乏', '丙', '弁', '尼', '矛', '矢', '旦',
                    '只', '叩', '凸', '斥', '仙', '瓦', '凹', '丘', '句', '甲', '玄', '巧', '功',
                    '穴', '叱', '囚', '汁', '尻', '丼', '匠', '巡', '旬', '充', '芝', '朱', '至',
                    '旨', '后', '江', '此', '刑', '仰', '朽', '吉', '企', '缶', '芋', '扱', '伊',
                    '舌', '尽', '迅', '壮', '吐', '吊', '羊', '吏', '劣', '妄', '朴', '弐', '如',
                    '伐', '帆', '妃', '伏', '肘', '扶', '芳', '邦', '尾', '伯', '伴', '尿', '妊',
                    '忍', '把', '妨', '吠', '没', '妙', '励', '呂', '抑', '里', '呈', '廷', '豆',
                    '那', '択', '沢', '即', '汰', '妥', '芯', '杉', '亜', '壱', '沖', '我', '戒',
                    '肝', '岐', '忌', '却', '汽', '狂', '吟', '系', '克', '攻', '坑', '孝', '抗',
                    '呉', '沙', '災', '佐', '寿', '秀', '序', '抄', '肖', '尚', '松', '沼', '宗',
                    '呪', '邪', '叔', '舎', '肢', '昆', '忽', '祉', '侍', '弦', '股', '拘', '茎',
                    '屈', '径', '享', '拒', '拠', '宜', '奇', '拐', '劾', '芽', '怪', '岳', '於',
                    '往', '殴', '岡', '佳', '沿', '炎', '宛', '或', '枢', '炊', '垂', '拙', '析',
                    '斉', '征', '其', '阻', '狙', '拓', '卓', '忠', '抽', '奈', '抵', '坪', '邸',
                    '迭', '典', '炉', '岬', '免', '茂', '盲', '房', '肪', '牧', '奔', '抹', '枕',
                    '拍', '迫', '肥', '披', '泌', '奉', '泡', '併', '苗', '附', '侮', '枠', '茹',
                    '郎', '眉', '柄', '赴', '卑', '派', '肺', '胞', '盆', '某', '冒', '殆', '柳',
                    '厘', '幽', '訂', '津', '亭', '帝', '剃', '貞', '峠', '洞', '衷', '挑', '勅',
                    '胎', '胆', '奏', '促', '耐', '怠', '俗', '荘', '牲', '宣', '窃', '染', '甚',
                    '是', '哀', '威', '為', '姻', '疫', '架', '卸', '垣', '冠', '括', '悔', '咳',
                    '紀', '軌', '虐', '糾', '峡', '契', '皇', '垢', '孤', '恒', '洪', '拷', '弧',
                    '姿', '施', '恨', '砕', '削', '拶', '狩', '俊', '臭', '昭', '叙', '盾', '浄',
                    '侵', '唇', '娠', '振', '浸', '症', '准', '徐', '宵', '祥', '称', '従', '疾',
                    '殉', '珠', '殊', '酌', '射', '唆', '宰', '剤', '桟', '蚕', '剛', '栽', '索',
                    '桜', '娯', '悟', '倹', '兼', '剣', '貢', '郡', '桑', '恭', '脅', '挙', '宮',
                    '飢', '既', '鬼', '陥', '華', '蚊', '株', '釜', '核', '恩', '俺', '益', '悦',
                    '宴', '浦', '挨', '凄', '粋', '衰', '辱', '陣', '扇', '栓', '逝', '隻', '挿',
                    '泰', '袖', '倉', '素', '租', '託', '逐', '秩', '致', '透', '討', '桃', '匿',
                    '胴', '逓', '哲', '唐', '倫', '竜', '朗', '烈', '剖', '紋', '耗', '脈', '紡',
                    '梅', '這', '俳', '納', '秘', '班', '畔', '倣', '俸', '砲', '峰', '陛', '姫',
                    '紐', '俵', '浜', '敏', '紛', '浪', '脇', '瓶', '票', '描', '偏', '崩', '舶',
                    '排', '陪', '粘', '培', '堀', '麻', '密', '猛', '訳', '累', '隆', '陵', '猟',
                    '悠', '唯', '庸', '悼', '笛', '添', '偵', '壷', '釣', '豚', '陶', '彫', '帳',
                    '窒', '眺', '陳', '逮', '脱', '蛋', '淡', '粗', '爽', '措', '曽', '曹', '巣',
                    '惜', '崇', '盛', '旋', '推', '据', '酔', '尉', '陰', '逸', '殻', '掛', '勘',
                    '郭', '喝', '渇', '崖', '涯', '眼', '患', '貫', '偽', '脚', '虚', '菌', '郷',
                    '啓', '菊', '掲', '渓', '蛍', '頃', '控', '惨', '執', '視', '崎', '紺', '彩',
                    '斎', '惚', '赦', '斜', '釈', '寂', '蛇', '粛', '淑', '渋', '訟', '梢', '渉',
                    '庶', '唱', '剰', '紳', '尋', '硝', '殖', '掌', '循', '焦', '晶', '証', '詔',
                    '粧', '就', '衆', '軸', '煮', '詐', '裁', '紫', '滋', '傘', '策', '慌', '項',
                    '絞', '喧', '圏', '堅', '喉', '遇', '琴', '筋', '暁', '僅', '距', '閑', '欺',
                    '棋', '稀', '貴', '敢', '棺', '款', '喚', '堪', '揮', '幾', '賀', '椅', '街',
                    '渦', '握', '援', '詠', '随', '遂', '酢', '診', '葬', '属', '惰', '揃', '堕',
                    '疎', '喪', '創', '訴', '弾', '棚', '隊', '塚', '棟', '痘', '統', '堤', '提',
                    '貼', '搭', '揚', '揺', '雄', '湧', '猶', '裕', '嵐', '塁', '痢', '硫', '廊',
                    '裂', '愉', '貰', '婿', '媒', '覗', '廃', '博', '筈', '蛮', '扉', '傍', '遍',
                    '塀', '雰', '惑', '壺', '賄', '碗', '墓', '飽', '搬', '微', '鉢', '煩', '頒',
                    '漠', '盟', '滅', '幕', '廉', '鈴', '楼', '虜', '溜', '裸', '雷', '酪', '誉',
                    '頓', '艇', '督', '腸', '跳', '馳', '蓄', '滝', '痴', '稚', '嘆', '僧', '塑',
                    '践', '禅', '滞', '賊', '腎', '睡', '裾', '跡', '摂', '聖', '誠', '鉛', '猿',
                    '禍', '嫁', '該', '暇', '隔', '滑', '褐', '勧', '雅', '嘩', '蓋', '塊', '慨',
                    '頑', '寛', '幹', '棄', '義', '愚', '隙', '傑', '継', '携', '碁', '誇', '源',
                    '嫌', '献', '絹', '遣', '溝', '鼓', '嗣', '飼', '慈', '詩', '載', '搾', '債',
                    '催', '蒔', '腫', '愁', '酬', '詳', '傷', '奨', '飾', '慎', '障', '銃', '彰',
                    '塾', '需', '遮', '魂', '雌', '磁', '漆', '酸', '綱', '酵', '豪', '穀', '酷',
                    '獄', '駆', '鞄', '旗', '概', '閣', '箇', '寡', '餌', '嘘', '隠', '稲', '維',
                    '誓', '遭', '態', '駄', '噌', '銭', '漸', '端', '奪', '徴', '嫡', '漬', '徳',
                    '摘', '誘', '僚', '暦', '膜', '僕', '墨', '銘', '模', '慢', '漫', '網', '罰',
                    '閥', '碑', '寧', '賑', '慕', '腐', '漂', '漏', '敷', '賓', '撫', '噴', '墳',
                    '憤', '膝', '賦', '舗', '穂', '幣', '弊', '褒', '縄', '輩', '賠', '罷', '盤',
                    '箸', '黙', '魅', '撲', '頬', '範', '摩', '霊', '寮', '履', '慮', '憂', '窯',
                    '養', '敵', '徹', '撤', '賭', '締', '墜', '踏', '憧', '蝶', '潮', '諾', '鋳',
                    '誰', '誕', '遷', '槽', '請', '潜', '澄', '噂', '慰', '影', '謁', '閲', '縁',
                    '遺', '稼', '潟', '噛', '餓', '嬉', '歓', '監', '緩', '窮', '輝', '儀', '戯',
                    '勲', '慶', '潔', '緊', '稿', '撃', '暫', '撒', '賜', '撮', '趣', '熟', '潤',
                    '遵', '衝', '嘱', '審', '壌', '嬢', '獣', '縦', '儒', '樹', '諮', '錯', '激',
                    '憲', '墾', '鋼', '衡', '凝', '興', '稽', '憩', '薫', '還', '憾', '懐', '壊',
                    '獲', '穏', '憶', '衛', '緯', '薦', '錠', '濁', '壇', '糖', '篤', '謎', '謡',
                    '諭', '融', '擁', '隣', '錬', '膨', '謀', '繁', '縛', '避', '縫', '奮', '髭',
                    '頻', '濡', '翼', '覧', '鍋', '謄', '瞳', '聴', '鍛', '鮮', '霜', '繊', '闇',
                    '轄', '霞', '擬', '犠', '謹', '矯', '購', '謙', '鍵', '厳', '擦', '懇', '謝',
                    '縮', '醜', '礁', '償', '醤', '織', '瞬', '鎖', '顕', '襟', '騎', '穫', '騒',
                    '繕', '礎', '鎮', '懲', '藤', '闘', '濫', '離', '臨', '糧', '翻', '繭', '癒',
                    '藩', '覆', '癖', '簿', '譜', '覇', '霧', '麗', '羅', '蘇', '藻', '瀬', '髄',
                    '韻', '鏡', '繰', '鶏', '鯨', '蹴', '譲', '醸', '鐘', '懸', '護', '響', '籍',
                    '騰', '欄', '露', '躍', '魔', '艦', '顧', '襲', '驚', '鑑'
                ];

                document.getElementById('loading-indicator').style.display = 'none';
                loadMoreKanji();
            }

            function loadMoreKanji() {
                const grid = document.getElementById('kanji-grid');
                const nextBatch = allKanjiList.slice(displayedCount, displayedCount + BATCH_SIZE);
                nextBatch.forEach(char => {
                    const card = document.createElement('div');
                    card.className = 'kanji-card';
                    card.innerHTML = `<span class="kanji-char">${char}</span>`;
                    card.onclick = () => openDetail(char);
                    grid.appendChild(card);
                });
                displayedCount += nextBatch.length;
                document.getElementById('load-more').style.display = displayedCount < allKanjiList.length ? 'block' : 'none';
            }



            async function openDetail(char) {
                console.log('Opening detail for:', char);
                currentKanjiIndex = allKanjiList.indexOf(char);

                // Toggle views
                document.getElementById('grid-view').classList.remove('active');
                document.getElementById('detail-view').classList.add('active');

                // Reset content
                document.getElementById('detail-char').textContent = char;
                document.getElementById('detail-meaning').textContent = 'Loading...';
                document.getElementById('detail-onyomi').textContent = '-';
                document.getElementById('detail-kunyomi').textContent = '-';
                document.getElementById('stroke-container').innerHTML = 'Loading...';

                try {
                    // Fetch Kanji Details
                    const response = await fetch(`https://kanjiapi.dev/v1/kanji/${char}`);
                    if (!response.ok) throw new Error('Network response was not ok');
                    const data = await response.json();

                    document.getElementById('detail-meaning').textContent = data.meanings.join(', ');

                    const onReadings = data.on_readings || [];
                    const kunReadings = data.kun_readings || [];

                    const onRomaji = onReadings.map(r => `${r} (${toRomaji(r)})`).join(', ');
                    const kunRomaji = kunReadings.map(r => `${r} (${toRomaji(r)})`).join(', ');
                    document.getElementById('detail-onyomi').textContent = onRomaji || '-';
                    document.getElementById('detail-kunyomi').textContent = kunRomaji || '-';

                    loadStrokeOrder(char);
                } catch (error) {
                    console.error('Error fetching kanji details:', error);
                    document.getElementById('detail-meaning').textContent = 'Error loading data';
                }
            }

            function showGrid() {
                document.getElementById('detail-view').classList.remove('active');
                document.getElementById('grid-view').classList.add('active');
            }

            function nextChar() { if (currentKanjiIndex < allKanjiList.length - 1) openDetail(allKanjiList[currentKanjiIndex + 1]); }
            function prevChar() { if (currentKanjiIndex > 0) openDetail(allKanjiList[currentKanjiIndex - 1]); }

            function getUnicodeHex(char) {
                let hex = char.charCodeAt(0).toString(16);
                while (hex.length < 5) hex = "0" + hex;
                return hex;
            }

            function loadStrokeOrder(char) {
                const container = document.getElementById('stroke-container');
                container.innerHTML = '<span style="color: #ccc;">Loading...</span>';
                const hex = getUnicodeHex(char);
                const url = `https://raw.githubusercontent.com/KanjiVG/kanjivg/master/kanji/${hex}.svg`;

                fetch(url)
                    .then(res => res.text())
                    .then(svgData => {
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(svgData, "image/svg+xml");
                        const svgElement = doc.querySelector("svg");
                        if (svgElement) {
                            container.innerHTML = "";
                            container.appendChild(svgElement);
                            animateStrokes();
                        } else { container.innerHTML = "No animation"; }
                    })
                    .catch(() => container.innerHTML = "No animation");
            }

            function animateStrokes() {
                const paths = document.querySelectorAll('.stroke-placeholder path');
                paths.forEach((path, index) => {
                    const length = path.getTotalLength();
                    path.style.strokeDasharray = length;
                    path.style.strokeDashoffset = length;
                    path.style.animation = `draw 1s linear forwards ${index * 0.8}s`;
                });
            }

            function replayAnimation() {
                const container = document.getElementById('stroke-container');
                const svg = container.innerHTML;
                container.innerHTML = '';
                setTimeout(() => { container.innerHTML = svg; animateStrokes(); }, 10);
            }
        </script>
</body>

</html>